<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="200code">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="200code">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="200code">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> 200code </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">200code</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/11/性能优化/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/11/性能优化/" itemprop="url">
                  性能优化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-11T20:25:47+08:00">
                2017-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="ui优化"><a href="#ui优化" class="headerlink" title="ui优化"></a>ui优化</h1><h2 id="防止过度绘制"><a href="#防止过度绘制" class="headerlink" title="防止过度绘制"></a>防止过度绘制</h2><h3 id="view层级控制"><a href="#view层级控制" class="headerlink" title="view层级控制"></a>view层级控制</h3><ol>
<li>逻辑上控制层级</li>
<li>merge<h3 id="避免过多主动调用invalidata"><a href="#避免过多主动调用invalidata" class="headerlink" title="避免过多主动调用invalidata()"></a>避免过多主动调用invalidata()</h3><h3 id="避免过多主动调用requestlayout"><a href="#避免过多主动调用requestlayout" class="headerlink" title="避免过多主动调用requestlayout()"></a>避免过多主动调用requestlayout()</h3><h3 id="使用canvas-cliprect-局部绘制"><a href="#使用canvas-cliprect-局部绘制" class="headerlink" title="使用canvas cliprect() 局部绘制"></a>使用canvas cliprect() 局部绘制</h3><h2 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h2>viewstub<h2 id="使用硬件加速"><a href="#使用硬件加速" class="headerlink" title="使用硬件加速"></a>使用硬件加速</h2><h2 id="使用surfaceView"><a href="#使用surfaceView" class="headerlink" title="使用surfaceView"></a>使用surfaceView</h2><h2 id="检测工具"><a href="#检测工具" class="headerlink" title="检测工具"></a>检测工具</h2>traceView<br>monitors的gpu选项</li>
</ol>
<hr>
<h1 id="内存优化"><a href="#内存优化" class="headerlink" title="内存优化"></a>内存优化</h1><h2 id="防止内存泄漏"><a href="#防止内存泄漏" class="headerlink" title="防止内存泄漏"></a>防止内存泄漏</h2><p>资源要及时回收 cursor, io, 注册，单例，handler， 静态view引用，异步持有view引用</p>
<h2 id="减少内存"><a href="#减少内存" class="headerlink" title="减少内存"></a>减少内存</h2><p>bitmap采样，arrayMap代替hashmap，sparseArray代替hashmap，使用intentservice，使用asynctask，<br>handlerThread，localbroadCastReceiver，缓存lrucache，listview holder，threadpool</p>
<h2 id="为android-应用申请更多内存"><a href="#为android-应用申请更多内存" class="headerlink" title="为android 应用申请更多内存"></a>为android 应用申请更多内存</h2><h3 id="获取Dalvik初始分配的内存大小"><a href="#获取Dalvik初始分配的内存大小" class="headerlink" title="获取Dalvik初始分配的内存大小"></a>获取Dalvik初始分配的内存大小</h3><h4 id="1-查看-system-build-prop文件"><a href="#1-查看-system-build-prop文件" class="headerlink" title="1. 查看/system/build.prop文件"></a>1. 查看/system/build.prop文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dalvik.vm.heapstartsize=8m</div><div class="line">dalvik.vm.heapgrowthlimit=192m</div><div class="line">dalvik.vm.heapsize=512m</div></pre></td></tr></table></figure>
<p>dalvik.vm.heapstartsize=8m 相当于虚拟机的 -Xms配置，该项用来设置堆内存的初始大小。<br>dalvik.vm.heapgrowthlimit=192m 相当于虚拟机的 -XX:HeapGrowthLimit配置，该项用来设置一个标准的应用的最大堆内存大小。一个标准的应用就是没有使用android:largeHeap的应用。<br>dalvik.vm.heapsize=512m 相当于虚拟机的 -Xmx配置，该项设置了使用android:largeHeap的应用的最大堆内存大小。</p>
<h3 id="2-使用adb查看"><a href="#2-使用adb查看" class="headerlink" title="2. 使用adb查看"></a>2. 使用adb查看</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">adb shell getprop|grep dalvik.vm.heapstartsize 应用启动后分配的初始内存</div><div class="line">adb shell getprop|grep heapgrowthlimit 单个标准应用程序最大内存限制（没设置android:largeHeap）</div><div class="line">adb shell getprop|grep dalvik.vm.heapsize 单个dalvik虚拟机最大的内存限制（设置了android:largeHeap）</div></pre></td></tr></table></figure>
<h3 id="3-使用ActivityManager"><a href="#3-使用ActivityManager" class="headerlink" title="3. 使用ActivityManager"></a>3. 使用ActivityManager</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ActivityManager activityManager =(ActivityManager)context.getSystemService(Context.ACTIVITY_SERVICE);</div><div class="line">activityManager.getMemoryClass();</div><div class="line">activityManager.getLargeMemoryClass();</div></pre></td></tr></table></figure>
<p>ActivityManager的getMemoryClass()获得内用正常情况下内存的大小<br>ActivityManager的getLargeMemoryClass()可以获得开启largeHeap最大的内存大小</p>
<h3 id="申请大内存"><a href="#申请大内存" class="headerlink" title="申请大内存"></a>申请大内存</h3><p>在application元素上加入android:largeHeap=”true”申请大内存</p>
<h2 id="检测工具-1"><a href="#检测工具-1" class="headerlink" title="检测工具"></a>检测工具</h2><p>monitors的memery选项</p>
<hr>
<h1 id="包大小优化"><a href="#包大小优化" class="headerlink" title="包大小优化"></a>包大小优化</h1><p>proguard minify，shrink png</p>
<hr>
<h1 id="省电"><a href="#省电" class="headerlink" title="省电"></a>省电</h1><h2 id="屏幕"><a href="#屏幕" class="headerlink" title="屏幕"></a>屏幕</h2><p>屏幕锁</p>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><ol>
<li>压缩数据</li>
<li>延后发送数据</li>
<li>打包数据发送<h2 id="检测工具-2"><a href="#检测工具-2" class="headerlink" title="检测工具"></a>检测工具</h2>monitors的cpu选项<br>monitors的network选项</li>
</ol>
<hr>
<h1 id="计算速度优化"><a href="#计算速度优化" class="headerlink" title="计算速度优化"></a>计算速度优化</h1><h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><h3 id="优化前："><a href="#优化前：" class="headerlink" title="优化前："></a>优化前：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">for(int i = 0; i &lt; list.size;  i++)&#123;&#125;</div></pre></td></tr></table></figure>
<h3 id="优化后："><a href="#优化后：" class="headerlink" title="优化后："></a>优化后：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">for(int i = 0,int len = list.size; i &lt; len ; i++)&#123;&#125;</div></pre></td></tr></table></figure>
<h2 id="如何提高-x-gt-0-x-0-的效率？"><a href="#如何提高-x-gt-0-x-0-的效率？" class="headerlink" title="如何提高 x &gt; 0 ? x : 0 的效率？"></a>如何提高 x &gt; 0 ? x : 0 的效率？</h2><p>使用 Math.max(0, x); 更高效</p>
<hr>
<h1 id="性能优化工具"><a href="#性能优化工具" class="headerlink" title="性能优化工具"></a>性能优化工具</h1><h2 id="monitors的cpu选项"><a href="#monitors的cpu选项" class="headerlink" title="monitors的cpu选项"></a>monitors的cpu选项</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/11/gitignore模版/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/11/gitignore模版/" itemprop="url">
                  .gitignore模版
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-11T09:47:56+08:00">
                2017-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p>文件 .gitignore 的格式规范如下：</p>
<ul>
<li>所有空行或者以注释符号 ＃ 开头的行都会被 Git 忽略。</li>
<li>可以使用标准的 glob 模式匹配。</li>
<li>匹配模式最后跟反斜杠（/）说明要忽略的是目录。</li>
<li>要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（!）取反。</li>
</ul>
<p>所谓的 glob 模式是指 shell 所使用的简化了的正则表达式。星号（*）匹配零个或多个任意字符；[abc] 匹配任何一个列在方括号中的字符（这个例子要么匹配一个 a，要么匹配一个 b，要么匹配一个 c）；问号（?）只匹配一个任意字符；如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配（比如 [0-9] 表示匹配所有 0 到 9 的数字）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">#built application files</div><div class="line">*.apk</div><div class="line">*.ap_</div><div class="line"></div><div class="line"># files for the dex VM</div><div class="line">*.dex</div><div class="line"></div><div class="line"># Java class files</div><div class="line">*.class</div><div class="line"></div><div class="line"># generated files</div><div class="line">bin/</div><div class="line">gen/</div><div class="line">out/</div><div class="line">build/</div><div class="line">#  build/  忽略所有的 build/ 目录下文件</div><div class="line">#  /build  只忽略此目录下build文件，子目录的build不忽略</div><div class="line"></div><div class="line"># Local configuration file (sdk path, etc)</div><div class="line">local.properties</div><div class="line"></div><div class="line"># Windows thumbnail db</div><div class="line">Thumbs.db</div><div class="line"></div><div class="line"># OSX files</div><div class="line">.DS_Store</div><div class="line"></div><div class="line"># Eclipse project files</div><div class="line">.classpath</div><div class="line">.project</div><div class="line"></div><div class="line"># Android Studio</div><div class="line">*.iml</div><div class="line">.idea</div><div class="line"></div><div class="line"># Local IDEA workspace</div><div class="line">.idea/workspace.xml</div><div class="line"></div><div class="line"># Gradle cache</div><div class="line">.gradle</div><div class="line"></div><div class="line">#NDK</div><div class="line">obj/</div><div class="line"></div><div class="line">.settings/</div><div class="line">*.properties</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/11/proguard-rules-pro模版/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/11/proguard-rules-pro模版/" itemprop="url">
                  proguard-rules.pro模版
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-11T09:46:58+08:00">
                2017-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div></pre></td><td class="code"><pre><div class="line"># To enable ProGuard in your project, edit project.properties</div><div class="line"># to define the proguard.config property as described in that file.</div><div class="line">#</div><div class="line"># Add project specific ProGuard rules here.</div><div class="line"># By default, the flags in this file are appended to flags specified</div><div class="line"># in $&#123;sdk.dir&#125;/tools/proguard/proguard-android.txt</div><div class="line"># You can edit the include path and order by changing the ProGuard</div><div class="line"># include property in project.properties.</div><div class="line">#</div><div class="line"># For more details, see</div><div class="line">#   http://developer.android.com/guide/developing/tools/proguard.html</div><div class="line"></div><div class="line"># Add any project specific keep options here:</div><div class="line"></div><div class="line"># If your project uses WebView with JS, uncomment the following</div><div class="line"># and specify the fully qualified class name to the JavaScript interface</div><div class="line"># class:</div><div class="line">#-keepclassmembers class fqcn.of.javascript.interface.for.webview &#123;</div><div class="line">#   public *;</div><div class="line">#&#125;</div><div class="line">-optimizationpasses 9                                                           # 指定代码的压缩级别</div><div class="line">-dontusemixedcaseclassnames                                                     # 是否使用大小写混合</div><div class="line">-dontskipnonpubliclibraryclasses                                                # 是否混淆第三方jar</div><div class="line">-dontpreverify                                                                  # 混淆时是否做预校验</div><div class="line">-keepattributes SourceFile,LineNumberTable										# 混淆号错误信息里带上代码行</div><div class="line">-verbose                                                                        # 混淆时是否记录日志</div><div class="line">-optimizations !code/simplification/arithmetic,!field/*,!class/merging/*        # 混淆时所采用的算法</div><div class="line"></div><div class="line">-repackageclasses &apos;&apos;</div><div class="line">-allowaccessmodification</div><div class="line">-dontwarn</div><div class="line"></div><div class="line"></div><div class="line"># keep 4大组件， application</div><div class="line">-keep public class * extends android.app.Activity</div><div class="line">-keep public class * extends android.app.Application</div><div class="line">-keep public class * extends android.app.Service</div><div class="line">-keep public class * extends android.content.BroadcastReceiver</div><div class="line">-keep public class * extends android.content.ContentProvider</div><div class="line"></div><div class="line"># 自定义的view类</div><div class="line">-keep public class * extends android.view.View &#123;</div><div class="line">    public &lt;init&gt;(android.content.Context);</div><div class="line">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</div><div class="line">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</div><div class="line">    public void set*(...);</div><div class="line">&#125;</div><div class="line">#To maintain custom components names that are used on layouts XML:</div><div class="line">-keep public class * extends android.view.View &#123;</div><div class="line">    public &lt;init&gt;(android.content.Context);</div><div class="line">&#125;</div><div class="line">-keep public class * extends android.view.View &#123;</div><div class="line">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</div><div class="line">&#125;</div><div class="line">-keep public class * extends android.view.View &#123;</div><div class="line">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</div><div class="line">&#125;</div><div class="line"></div><div class="line"># Serializables类</div><div class="line">-keepnames class * implements java.io.Serializable</div><div class="line">-keepclassmembers class * implements java.io.Serializable &#123;</div><div class="line">    static final long serialVersionUID;</div><div class="line">    private static final java.io.ObjectStreamField[] serialPersistentFields;</div><div class="line">    !static !transient &lt;fields&gt;;</div><div class="line">    !private &lt;fields&gt;;</div><div class="line">    !private &lt;methods&gt;;</div><div class="line">    private void writeObject(java.io.ObjectOutputStream);</div><div class="line">    private void readObject(java.io.ObjectInputStream);</div><div class="line">    java.lang.Object writeReplace();</div><div class="line">    java.lang.Object readResolve();</div><div class="line">&#125;</div><div class="line"></div><div class="line"># support v7类</div><div class="line">-keep class android.support.v7.** &#123; *; &#125;</div><div class="line">-keep interface android.support.v7.** &#123; *; &#125;</div><div class="line"></div><div class="line">#Compatibility library</div><div class="line">-keep public class * extends android.support.v4.app.Fragment</div><div class="line">-keep public class * extends android.app.Fragment</div><div class="line"></div><div class="line"># 第三方包类</div><div class="line">-libraryjars libs/jackson-all-1.9.11.jar</div><div class="line">-keep class org.codehaus.jackson.**&#123;*;&#125;</div><div class="line"></div><div class="line"># keep 类成员</div><div class="line">-keepclasseswithmembers class * &#123;</div><div class="line">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</div><div class="line">&#125;</div><div class="line">-keepclasseswithmembers class * &#123;</div><div class="line">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</div><div class="line">&#125;</div><div class="line"></div><div class="line"># keep parcelable</div><div class="line">-keepclassmembers class * implements android.os.Parcelable &#123;</div><div class="line">    static android.os.Parcelable$Creator CREATOR;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#Keep the R</div><div class="line">-keepclassmembers class **.R$* &#123;</div><div class="line">    public static &lt;fields&gt;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-keepclassmembers public class * extends android.view.View &#123;</div><div class="line">  void set*(***);</div><div class="line">  *** get*();</div><div class="line">&#125;</div><div class="line"></div><div class="line">#Maintain java native methods</div><div class="line">-keepclasseswithmembernames class * &#123;</div><div class="line">    native &lt;methods&gt;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#Maintain enums</div><div class="line">-keepclassmembers enum * &#123;</div><div class="line">    public static **[] values();</div><div class="line">    public static ** valueOf(java.lang.String);</div><div class="line">&#125;</div><div class="line"></div><div class="line"># Remove Logging</div><div class="line">-assumenosideeffects class android.util.Log &#123;</div><div class="line">    public static *** d(...);</div><div class="line">    public static *** w(...);</div><div class="line">    public static *** v(...);</div><div class="line">    public static *** i(...);</div><div class="line">&#125;</div><div class="line"></div><div class="line">-ignorewarnings</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># others =============================================================================== 参考</div><div class="line"></div><div class="line"># Android Support Library类</div><div class="line">-keep class android.** &#123;*;&#125;</div><div class="line"></div><div class="line"># 不混淆的第三方包</div><div class="line">-libraryjars libs/juniversalchardet-1.0.3.jar</div><div class="line">-libraryjars libs/jaudiotagger-2.0.3.jar</div><div class="line">-libraryjars libs/jackson-all-1.9.11.jar</div><div class="line">-keep class com.xui.launcher.icarmusic.view.**&#123;*; &#125;</div><div class="line">-keep class org.mozilla.universalchardet.**&#123;*;&#125;</div><div class="line">-keep class org.jaudiotagger.**&#123;*;&#125;</div><div class="line">-keep class org.codehaus.jackson.**&#123;*;&#125;</div><div class="line"></div><div class="line"></div><div class="line">-libraryjars libs/android_api.jar</div><div class="line">-libraryjars libs/baidumapapi_v2_2_0.jar</div><div class="line">-libraryjars libs/armeabi.jar</div><div class="line">-libraryjars libs/locSDK_3.1.jar</div><div class="line">-libraryjars libs/pushservice-2.4.0.jar</div><div class="line"></div><div class="line"># Baidu Map</div><div class="line">-keep class com.baidu.mapapi.** &#123;*; &#125;</div><div class="line">-keep class com.baidu.location.** &#123;*; &#125;</div><div class="line">-keep class com.baidu.platform.** &#123;*; &#125;</div><div class="line">-keep class com.baidu.vi.** &#123;*; &#125;</div><div class="line">-keep class vi.com.gdi.bgl.android.java.** &#123;*; &#125;</div><div class="line"></div><div class="line"># Baidu Push</div><div class="line">-keep class com.baidu.android.** &#123;*; &#125;</div><div class="line">-keep class com.baidu.loctp.** &#123;*; &#125;</div><div class="line"></div><div class="line">-keep class com.nineoldandroids.** &#123;*; &#125;</div><div class="line"></div><div class="line"># Baidu Tongji</div><div class="line">-keep class com.baidu.a.a.a.** &#123;*; &#125;</div><div class="line">-keep class com.baidu.mobstat.** &#123;*; &#125;</div><div class="line"></div><div class="line"># slidingmenu</div><div class="line">-keep class com.jeremyfeinstein.slidingmenu.lib.** &#123;*; &#125;</div><div class="line"></div><div class="line"># listviewAnimations</div><div class="line">-keep class com.haarman.listviewanimations.** &#123;*; &#125;</div><div class="line"></div><div class="line">#ACRA specifics</div><div class="line"># we need line numbers in our stack traces otherwise they are pretty useless</div><div class="line">-renamesourcefileattribute SourceFile</div><div class="line"></div><div class="line"># ACRA needs &quot;annotations&quot; so add this...</div><div class="line">-keepattributes *Annotation*</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/11/框架/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/11/框架/" itemprop="url">
                  框架
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-11T09:42:15+08:00">
                2017-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="volley"><a href="#volley" class="headerlink" title="volley"></a>volley</h1><h2 id="1-请求"><a href="#1-请求" class="headerlink" title="1.请求"></a>1.请求</h2><p>cache dispatcher     —-&gt;       network dispatcher<br>1）如果 http请求的头信息中 的cache-control  max-age字段 未过期则使用 cache   ttl(time to live)存活时间<br>2）如果 max-age 过期 则先显示缓存再发network dispatcher 发netwokr请求 返回304／200 把缓存写入硬盘  返回结果</p>
<h2 id="2-缓存"><a href="#2-缓存" class="headerlink" title="2. 缓存"></a>2. 缓存</h2><p>二级缓存<br>1）DiskCache<br>2）LruImageCache</p>
<h2 id="3-重试"><a href="#3-重试" class="headerlink" title="3.重试"></a>3.重试</h2><p>DefaultRetryPolicy   DEFAULT_MAX_RETRIES</p>
<h2 id="4-超时"><a href="#4-超时" class="headerlink" title="4.超时"></a>4.超时</h2><p>DefaultRetryPolicy  DEFAULT_TIMEOUT_MS<br>1）请求超时<br>2）接收数据超时</p>
<h2 id="5-日志"><a href="#5-日志" class="headerlink" title="5.日志"></a>5.日志</h2><p>VolleyLog</p>
<hr>
<h1 id="retrofit"><a href="#retrofit" class="headerlink" title="retrofit"></a>retrofit</h1><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">new Retrofit.Builder()  </div><div class="line">                .addConverterFactory(GsonConverterFactory.create())  </div><div class="line">                .addCallAdapterFactory(RxJavaCallAdapterFactory.create())  </div><div class="line">                .build();</div></pre></td></tr></table></figure>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p><img src="/uploads/retrofit.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/11/网络/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/11/网络/" itemprop="url">
                  网络
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-11T08:52:34+08:00">
                2017-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="URI（uniformresource-identifier）和URL（universal-resource-Loactor）的区别"><a href="#URI（uniformresource-identifier）和URL（universal-resource-Loactor）的区别" class="headerlink" title="URI（uniformresource identifier）和URL（universal resource Loactor）的区别"></a>URI（uniformresource identifier）和URL（universal resource Loactor）的区别</h1><p>一个URI定义了一种资源，它是一个定位符。<br>一个URI由两部分组成： scheme （URI协议名）：scheme-specific-part（URI协议对应的内容）<br>一个URL由三部分组成：scheme（协议）：// 主机IP地址  / 资源具体地址<br>一个URI是一个URL或URN<br>URL、URN是URI的子集<br>当对某种资源是URL还是URI产生疑惑时，用URI来定义它</p>
<hr>
<h1 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h1><p>超文本传输协议，用于网络间传输数据。传输的内容不仅是文本文字，还有图片，程序包，文件等各种格式的数据。<br>HTTP是一个应用层协议，由请求和响应构成，是一个标准的客户端服务器模型。HTTP是一个无状态的协议。</p>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p>请求行（负责请求的方式），消息头（负责请求的协议），正文（负责请求的内容）</p>
<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>状态行（负责响应的状态提示），消息头（负责相应的协议），正文（负责响应的内容） </p>
<h3 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h3><p>1XX   提示消息（成功接收，继续处理）<br>2XX  成功<br>3XX  重定向<br>4XX  客户端错误（url 资源错误）<br>5XX  服务器端错误（服务端没实现此功能）</p>
<h1 id="OSI网络模型"><a href="#OSI网络模型" class="headerlink" title="OSI网络模型"></a>OSI网络模型</h1><p>7层，应用程（经理）：负责写草稿 / 阅读信件  ————— 内容提供或阅读内容<br>6层，表示层（助理）：负责将草稿写成正规格式的信 / 翻译信的内容   —————加解密<br>5层，会话层（秘书）：负责写好信封（收信人地址） / 打开信件   —————建立通讯<br>4层，传输层（司机）：将信带到邮局 /  从邮局拿回信   —————确保数据传输</p>
<p>3层，网络层（排序工人）： 将信件根据收件地址分类  /  整理分类出信件    —————将发送方的数据传到接收方，路由器<br>2层，数据链路层（包装工人）：将信件包装 / 打开包装     —————管理比特数据，交换机<br>1层，物理层（搬运工人）： 将信件装上车 / 将信件卸下车    —————物理设备，传输高低电压，如电缆</p>
<hr>
<h1 id="tcp连接-为什么要进行3次握手，断开为什么要4次握手"><a href="#tcp连接-为什么要进行3次握手，断开为什么要4次握手" class="headerlink" title="tcp连接 为什么要进行3次握手，断开为什么要4次握手"></a>tcp连接 为什么要进行3次握手，断开为什么要4次握手</h1><h2 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h2><ul>
<li>A打电话给B，需要询问，你是B么？</li>
<li>B回答说我是B。</li>
<li>A堆B说，我找的就是你。<br>至此，A知道找对了B。B也知道A是要找他。<blockquote>
<p>如果不是3次握手的话，如果是客户端A和服务器B连接的话，A请求连接，B分配资源并回复的话，有可能会是A是误请求，这样容易造成资源浪费。<br>早期网络连接不稳定，引起路由寻址的问题，经常会连接出错，所以加了一次需要客户端A确认的操作。</p>
</blockquote>
</li>
</ul>
<p>相当于打电话时网络运营商连接了错的号码。<br>双方确定连接。<br>之后开始正式的传输数据。</p>
<h3 id="断开连接"><a href="#断开连接" class="headerlink" title="断开连接"></a>断开连接</h3><ul>
<li>A告诉B，我要说的说完了，我要挂电话了。</li>
<li>B告诉A， 好的。</li>
<li>B告诉A，我要说的也说完了，我也要挂电话了。</li>
<li>A告诉B，好的。<br>双方确定彼此都要挂断电话后，正式断开连接。<h2 id="什么是MIME"><a href="#什么是MIME" class="headerlink" title="什么是MIME"></a>什么是MIME</h2>用于标记传输的数据的文件类型。<br>最早应用于电子邮件系统，但后来也应用到浏览器，以及所有的cs 交互模型中。在HTTP协议中用Content-type描述。<br>MIME(Multipurpose Internet Mail Extensions)<br>多用途互联网邮件扩展类型，是一个互联网标准，标准定义在 <a href="http://www.cnpaf.net/class/rfcall/" target="_blank" rel="external">RFC</a> 文档中。<br>http post提交表单格式数据 content-type ：application/x-www-form-urlencoded<br>http post提交json格式数据 content-type ：application/json</li>
</ul>
<hr>
<h1 id="UDP协议"><a href="#UDP协议" class="headerlink" title="UDP协议"></a>UDP协议</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>UDP: User Datagram Protocol 用户数据报协议 是一种无连接的协议。UDP有不提供数据包分组、组装和不能对数据包进行排序的缺点，也就是说，当报文发送之后，是无法得知其是否安全完整到达的。UDP用来支持那些需要在计算机之间传输数据的网络应用。包括网络视频会议系统在内的众多的客户/服务器模式的网络应用都需要使用UDP协议。<a href="http://colobu.com/2014/10/21/udp-and-unicast-multicast-broadcast-anycast/" target="_blank" rel="external">参考</a> <a href="https://github.com/netty/netty/tree/4.0/example/src/main/java/io/netty/example/qotm" target="_blank" rel="external">Netty UDP 官方 demo</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>在选择使用协议的时候，选择UDP必须要谨慎。在网络质量令人十分不满意的环境下，UDP协议数据包丢失会比较严重。但是由于UDP的特性：它不属于连接型协议，因而具有资源消耗小，处理速度快的优点，所以通常音频、视频和普通数据在传送时使用UDP较多。<br>UDP广播：广播使用广播地址255.255.255.255，将消息发送到在同一广播网络上的每个主机。值得强调的是：本地广播信息是不会被路由器转发。当然这是十分容易理解的，因为如果路由器转发了广播信息，那么势必会引起网络瘫痪。这也是为什么IP协议的设计者故意没有定义互联网范围的广播机制。其实广播顾名思义，就是想局域网内所有的人说话，但是广播还是要指明接收者的端口号的，因为不可能接受者的所有端口都来收听广播。</p>
<h2 id="UDP广播"><a href="#UDP广播" class="headerlink" title="UDP广播"></a>UDP广播</h2><p>广播使用广播地址255.255.255.255，将消息发送到在同一广播网络上的每个主机。值得强调的是：本地广播信息是不会被路由器转发。当然这是十分容易理解的，因为如果路由器转发了广播信息，那么势必会引起网络瘫痪。这也是为什么IP协议的设计者故意没有定义互联网范围的广播机制。其实广播顾名思义，就是想局域网内所有的人说话，但是广播还是要指明接收者的端口号的，因为不可能接受者的所有端口都来收听广播。</p>
<h3 id="发送接收代码"><a href="#发送接收代码" class="headerlink" title="发送接收代码"></a>发送接收代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">public static void sendBroadcast(byte[] data, int port) throws Exception&#123;</div><div class="line">    DatagramSocket socket = new DatagramSocket();</div><div class="line">    socket.setBroadcast(true);</div><div class="line">    DatagramPacket packet = new DatagramPacket(data, data.length, InetAddress.getByName(&quot;255.255.255.255&quot;), port);</div><div class="line">    socket.send(packet);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public static void receiveBoradcast(int port) &#123;</div><div class="line">    new Thread(new Runnable() &#123;</div><div class="line"></div><div class="line">        DatagramSocket socket;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            while (true) &#123;</div><div class="line">                try &#123;</div><div class="line">                    receive(port);</div><div class="line">                &#125; catch (Exception e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        public void receive(int port) throws Exception&#123;</div><div class="line">            if (socket == null || socket.isClosed()) &#123;</div><div class="line">                socket = new DatagramSocket(port);</div><div class="line">                socket.setBroadcast(true);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            byte[] buffer = new byte[1024 * 100];</div><div class="line">            DatagramPacket packet = new DatagramPacket(buffer , buffer.length);</div><div class="line">            socket.receive(packet);</div><div class="line">            String data = new String(packet.getData(), 0, packet.getLength());</div><div class="line">            Log.i(&quot;receiver&quot;, data);</div><div class="line">            socket.close();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Netty-实现代码"><a href="#Netty-实现代码" class="headerlink" title="Netty 实现代码"></a>Netty 实现代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">public class Broadcast &#123;</div><div class="line"></div><div class="line">    Channel udpChannel;</div><div class="line"></div><div class="line">    public void send(String data) throws Exception&#123;</div><div class="line">        if(udpChannel != null) &#123;</div><div class="line">            udpChannel.writeAndFlush(data);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void init(int port) &#123;</div><div class="line">        NioEventLoopGroup group = new NioEventLoopGroup();</div><div class="line">        Bootstrap bootstrap = new Bootstrap();</div><div class="line">        bootstrap.group(group)</div><div class="line">                .channel(NioDatagramChannel.class)</div><div class="line">                .option(ChannelOption.SO_BROADCAST, true)</div><div class="line">                .handler(new MessageToMessageEncoder&lt;String&gt;() &#123;</div><div class="line">                    @Override</div><div class="line">                    protected void encode(ChannelHandlerContext ctx, String msg, List&lt;Object&gt; out) throws Exception &#123;</div><div class="line">                        InetSocketAddress remoteAddress = new InetSocketAddress(&quot;255.255.255.255&quot;, port);</div><div class="line">                        out.add(new DatagramPacket(Unpooled.copiedBuffer(msg, CharsetUtil.UTF_8), remoteAddress));</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">        udpChannel = bootstrap.bind(0).syncUninterruptibly().channel();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">public class BroadcastReceiver &#123;</div><div class="line"></div><div class="line">    public void start(int port)&#123;</div><div class="line">        Bootstrap b = new Bootstrap();</div><div class="line">        NioEventLoopGroup group = new NioEventLoopGroup();</div><div class="line">        try &#123;</div><div class="line">            b.group(group)</div><div class="line">                    .channel(NioDatagramChannel.class)</div><div class="line">                    .option(ChannelOption.SO_BROADCAST, true)</div><div class="line">                    .handler(new SimpleChannelInboundHandler&lt;DatagramPacket&gt;() &#123;</div><div class="line"></div><div class="line">                        @Override</div><div class="line">                        protected void messageReceived(ChannelHandlerContext ctx, DatagramPacket packet) throws Exception &#123;</div><div class="line">                            String req = packet.content().toString(CharsetUtil.UTF_8);</div><div class="line">                            System.out.println(req);</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">            b.bind(port).sync().channel().closeFuture().await();</div><div class="line">        &#125;catch (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;finally &#123;</div><div class="line">            group.shutdownGracefully();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="UDP多播"><a href="#UDP多播" class="headerlink" title="UDP多播"></a>UDP多播</h2><p>多播数据报套接字类用于发送和接收 IP 多播包。MulticastSocket 是一种 (UDP) DatagramSocket，它具有加入 Internet 上其他多播主机的“组”的附加功能。<br>多播组通过 D 类 IP 地址和标准 UDP 端口号指定。D 类 IP 地址在 224.0.0.0 和 239.255.255.255 的范围内（包括两者）。地址 224.0.0.0 被保留，不应使用。</p>
<h3 id="多播代码"><a href="#多播代码" class="headerlink" title="多播代码"></a>多播代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">public class MultiBroadcast &#123;</div><div class="line"></div><div class="line">    public void startReveive(String host, int port) &#123;</div><div class="line"></div><div class="line">        new Thread(new Runnable() &#123;</div><div class="line"></div><div class="line">            MulticastSocket ms;</div><div class="line"></div><div class="line">            private void receive(String host, int port) throws Exception&#123;</div><div class="line">                byte[] buf = new byte[1024 * 100];</div><div class="line">                if(ms == null || ms.isClosed()) &#123;</div><div class="line">                    ms = new MulticastSocket(port);</div><div class="line">                    DatagramPacket dp = new DatagramPacket(buf, buf.length);</div><div class="line">                    InetAddress group = InetAddress.getByName(host);</div><div class="line">                    ms.joinGroup(group);</div><div class="line">                    ms.receive(dp);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                Log.i(&quot;receiver&quot;, new String(buf));</div><div class="line">                ms.close();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                while (true) &#123;</div><div class="line">                    try &#123;</div><div class="line">                        receive(host, port);</div><div class="line">                        Thread.sleep(100);</div><div class="line">                    &#125; catch (Exception e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void send(String host, int port, String message) throws Exception&#123;</div><div class="line">        InetAddress group = InetAddress.getByName(host);</div><div class="line">        MulticastSocket s = new MulticastSocket();</div><div class="line">        s.joinGroup(group);</div><div class="line">        DatagramPacket dp = new DatagramPacket(message.getBytes(),message.length(), group,port);</div><div class="line">        s.send(dp);</div><div class="line">        s.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="UDP单播"><a href="#UDP单播" class="headerlink" title="UDP单播"></a>UDP单播</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">public class UnicastBroadcast &#123;</div><div class="line"></div><div class="line">    public void send(String host, int port, byte[] message) throws Exception&#123;</div><div class="line">        //sending data to host and its port</div><div class="line">        InetAddress address = InetAddress.getByName(host);</div><div class="line">        // Initialize a datagram packet with data and address</div><div class="line">        DatagramPacket packet = new DatagramPacket(message, message.length, address, port);</div><div class="line">        // Create a datagram socket, send the packet through it, close it.</div><div class="line">        DatagramSocket dsocket = new DatagramSocket();</div><div class="line">        dsocket.send(packet);</div><div class="line">        dsocket.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void startReceive() &#123;</div><div class="line">        new Thread(new Runnable() &#123;</div><div class="line"></div><div class="line">            DatagramSocket dsocket;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            private void receive(int port) throws Exception&#123;</div><div class="line"></div><div class="line">                byte[] buffer = new byte[2048];</div><div class="line">                if(dsocket == null || dsocket.isClosed()) &#123;</div><div class="line">                    //receiving data from its port</div><div class="line">                    dsocket = new DatagramSocket(port);</div><div class="line">                    // Create a buffer to read datagrams into. If a</div><div class="line">                    // packet is larger than this buffer, the</div><div class="line">                    // excess will simply be discarded!</div><div class="line"></div><div class="line">                    // Create a packet to receive data into the buffer</div><div class="line">                    DatagramPacket packet = new DatagramPacket(buffer, buffer.length);</div><div class="line"></div><div class="line">                    // Wait to receive a datagram</div><div class="line">                    dsocket.receive(packet);</div><div class="line">                    // Convert the contents to a string, and display them</div><div class="line">                    String msg = new String(buffer);</div><div class="line">                    System.out.println(packet.getAddress().getHostName() + &quot;: &quot; + msg);</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                dsocket.close();</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="url编码问题"><a href="#url编码问题" class="headerlink" title="url编码问题"></a>url编码问题</h1><p>url 标准为美国制定，只支持asc编码，所以 </p>
<ol>
<li>get 请求等需要传递汉子等非asc编码支持的字符时，违背的这个标准，需要url encode</li>
<li>参数包含&amp; = 等这些标准连接的特殊符号时，也需要url encode</li>
</ol>
<h1 id="http（android-api）"><a href="#http（android-api）" class="headerlink" title="http（android api）"></a>http（android api）</h1><p>HttpURLConnection <a href="http://stackoverflow.com/questions/2793150/using-java-net-urlconnection-to-fire-and-handle-http-requests/2793153#2793153" target="_blank" rel="external">代码demo</a></p>
<h2 id="发送："><a href="#发送：" class="headerlink" title="发送："></a>发送：</h2><h3 id="1-设置协议："><a href="#1-设置协议：" class="headerlink" title="1.设置协议："></a>1.设置协议：</h3><p>con.setRequestMethod(“post”), timeout 等。</p>
<h3 id="2-发送内容："><a href="#2-发送内容：" class="headerlink" title="2.发送内容："></a>2.发送内容：</h3><p>os = con.getOutPutStream()。<br>os.writeBytes(json data 数据).toString()</p>
<h3 id="3-发送流结构："><a href="#3-发送流结构：" class="headerlink" title="3.发送流结构："></a>3.发送流结构：</h3><p>请求行（自动）<br>消息头（协议）<br>内容（数据）</p>
<h2 id="接收："><a href="#接收：" class="headerlink" title="接收："></a>接收：</h2><p>1.con.getInputStream();<br>read();<br>2.接收流结构<br>状态行（状态码）<br>消息头（协议）<br>内容（数据）</p>
<blockquote>
<p>注：https<br>在上面的设置协议中加入：</p>
<ol>
<li>setHostnameVerifier( );<br>2.构造器中加入 setDefaultSSLSocketFactory</li>
</ol>
</blockquote>
<h1 id="http（apache-api）"><a href="#http（apache-api）" class="headerlink" title="http（apache api）"></a>http（apache api）</h1><h2 id="post发送："><a href="#post发送：" class="headerlink" title="post发送："></a>post发送：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1.pos = new HttpPost（url）</div><div class="line">2.pos.setHeader()   协议</div><div class="line">3.pos.setEntity（） json数据</div><div class="line">4.re = new HttpClient（）.execute（pos）</div><div class="line">5.EntityUtils.toString(re.getEntity（）)</div></pre></td></tr></table></figure>
<h2 id="get发送："><a href="#get发送：" class="headerlink" title="get发送："></a>get发送：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1.get = new HttpGet（url）</div><div class="line">2.get.setHeader()</div><div class="line">3.re = new HttpClient().execute(get)</div><div class="line">4. status = re.getStatusline().getStatusCode()</div><div class="line">re.getEntity().getContent().</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/10/命令行/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/10/命令行/" itemprop="url">
                  命令行
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-10T16:42:45+08:00">
                2017-02-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="linux文件"><a href="#linux文件" class="headerlink" title="linux文件"></a>linux文件</h1><h2 id="列出目录下文件的权限"><a href="#列出目录下文件的权限" class="headerlink" title="列出目录下文件的权限"></a>列出目录下文件的权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ls －al</div></pre></td></tr></table></figure>
<h2 id="修改文件权限"><a href="#修改文件权限" class="headerlink" title="修改文件权限"></a>修改文件权限</h2><p>权限的字母表示：u-user  g-group  o-others  a-all<br>权限的数字表示：4-读  2-写  1-执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">chmod 777 a.txt</div><div class="line">chmod u=rwx, g=rwx, o=rwx a.txt</div><div class="line">chmod a=rwx a.txt</div></pre></td></tr></table></figure></p>
<h2 id="修改文件夹权限"><a href="#修改文件夹权限" class="headerlink" title="修改文件夹权限"></a>修改文件夹权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod -R 777  folder</div></pre></td></tr></table></figure>
<h2 id="查看文件夹的大小"><a href="#查看文件夹的大小" class="headerlink" title="查看文件夹的大小"></a>查看文件夹的大小</h2><p>du 命令 disk use<br>参数含义：<br>s:sum<br>h:human can read<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">du -sh ./sdk</div></pre></td></tr></table></figure></p>
<h2 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h2><p>以当前目录为根目录查找名字为DownloadManager.Java的文件所在位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find . -name &quot;DownloadManager.java&quot;</div></pre></td></tr></table></figure></p>
<h2 id="查找字符串"><a href="#查找字符串" class="headerlink" title="查找字符串"></a>查找字符串</h2><p>查找某目录下所有包含DownloadManager字符的文件<br>参数含义：<br>r:recurisive  递归<br>n:显示line number<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -rn DownloadManager /Users/peter/Downloads/Android4.4源码</div></pre></td></tr></table></figure></p>
<h2 id="删除jar包中的文件夹"><a href="#删除jar包中的文件夹" class="headerlink" title="删除jar包中的文件夹"></a>删除jar包中的文件夹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zip --delete baseproject.jar &quot;com/luajava/*&quot;</div></pre></td></tr></table></figure>
<hr>
<h1 id="adb"><a href="#adb" class="headerlink" title="adb"></a>adb</h1><h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><h3 id="重新安装"><a href="#重新安装" class="headerlink" title="重新安装"></a>重新安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb install com.xx.xx</div></pre></td></tr></table></figure>
<h3 id="重新安装，保持原程序数据"><a href="#重新安装，保持原程序数据" class="headerlink" title="重新安装，保持原程序数据"></a>重新安装，保持原程序数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb install -r com.xx.xx</div></pre></td></tr></table></figure>
<h3 id="安装到SD卡中"><a href="#安装到SD卡中" class="headerlink" title="安装到SD卡中"></a>安装到SD卡中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb install -s com.xx.xx</div></pre></td></tr></table></figure>
<h2 id="卸载程序"><a href="#卸载程序" class="headerlink" title="卸载程序"></a>卸载程序</h2><h3 id="完全卸载"><a href="#完全卸载" class="headerlink" title="完全卸载"></a>完全卸载</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb uninstall com.xx.xx</div></pre></td></tr></table></figure>
<h3 id="卸载，保留缓存"><a href="#卸载，保留缓存" class="headerlink" title="卸载，保留缓存"></a>卸载，保留缓存</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb uninstall －k com.xx.xxx</div></pre></td></tr></table></figure>
<h2 id="删除程序缓存"><a href="#删除程序缓存" class="headerlink" title="删除程序缓存"></a>删除程序缓存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell@android:/data/data/com.example.testandroidid # rm -rf cache</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell@android:/data/data/com.example.testandroidid # rm -r cache</div></pre></td></tr></table></figure>
<h2 id="log"><a href="#log" class="headerlink" title="log"></a>log</h2><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><h4 id="字符串xxx"><a href="#字符串xxx" class="headerlink" title="字符串xxx"></a>字符串xxx</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb logcat | grep xxx</div></pre></td></tr></table></figure>
<h4 id="error级"><a href="#error级" class="headerlink" title="error级"></a>error级</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb logcat | grep &quot;^E.123&quot; //tag 123</div></pre></td></tr></table></figure>
<h4 id="warning级"><a href="#warning级" class="headerlink" title="warning级"></a>warning级</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb logcat | grep &quot;^W.123&quot; //tag 123</div></pre></td></tr></table></figure>
<h4 id="所有"><a href="#所有" class="headerlink" title="所有"></a>所有</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb logcat | grep &quot;^..123&quot; //tag 123</div></pre></td></tr></table></figure>
<h3 id="清除"><a href="#清除" class="headerlink" title="清除"></a>清除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb logcat -c &amp;&amp; adb logcat</div></pre></td></tr></table></figure>
<h3 id="保存到本地"><a href="#保存到本地" class="headerlink" title="保存到本地"></a>保存到本地</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb logcat &gt; log.txt</div></pre></td></tr></table></figure>
<h2 id="kill-app"><a href="#kill-app" class="headerlink" title="kill app"></a>kill app</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pm force-stop com.xx.xx</div></pre></td></tr></table></figure>
<h2 id="列出所有安装包"><a href="#列出所有安装包" class="headerlink" title="列出所有安装包"></a>列出所有安装包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pm list package</div></pre></td></tr></table></figure>
<h2 id="修改host"><a href="#修改host" class="headerlink" title="修改host"></a>修改host</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">adb shell  </div><div class="line">su  </div><div class="line">vi /etc/hosts</div></pre></td></tr></table></figure>
<h2 id="打开网页"><a href="#打开网页" class="headerlink" title="打开网页"></a>打开网页</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell am start -a android.intent.action.VIEW -d http://www.baidu.com</div></pre></td></tr></table></figure>
<h2 id="打开入口程序列表"><a href="#打开入口程序列表" class="headerlink" title="打开入口程序列表"></a>打开入口程序列表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell am start -a &quot;android.intent.action.MAIN&quot;</div></pre></td></tr></table></figure>
<h2 id="获取分辨率"><a href="#获取分辨率" class="headerlink" title="获取分辨率"></a>获取分辨率</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell wm size</div></pre></td></tr></table></figure>
<h2 id="设置分辨率"><a href="#设置分辨率" class="headerlink" title="设置分辨率"></a>设置分辨率</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell wm size 540x960</div></pre></td></tr></table></figure>
<h2 id="还原分辨率"><a href="#还原分辨率" class="headerlink" title="还原分辨率"></a>还原分辨率</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell wm size reset</div></pre></td></tr></table></figure>
<h2 id="获取屏幕密度"><a href="#获取屏幕密度" class="headerlink" title="获取屏幕密度"></a>获取屏幕密度</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell wm density</div></pre></td></tr></table></figure>
<h2 id="设置屏幕密度"><a href="#设置屏幕密度" class="headerlink" title="设置屏幕密度"></a>设置屏幕密度</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell wm density 320</div></pre></td></tr></table></figure>
<h2 id="还原屏幕密度"><a href="#还原屏幕密度" class="headerlink" title="还原屏幕密度"></a>还原屏幕密度</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell wm density reset</div></pre></td></tr></table></figure>
<h2 id="“Read-only-file-system”解决办法"><a href="#“Read-only-file-system”解决办法" class="headerlink" title="“Read-only file system”解决办法"></a>“Read-only file system”解决办法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb remount</div></pre></td></tr></table></figure>
<h2 id="查询端口所在进程"><a href="#查询端口所在进程" class="headerlink" title="查询端口所在进程"></a>查询端口所在进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo netstat -tulpn | grep :8000</div></pre></td></tr></table></figure>
<h2 id="kill-pid"><a href="#kill-pid" class="headerlink" title="kill pid"></a>kill pid</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kill -9 &lt;进程 pid&gt;</div></pre></td></tr></table></figure>
<h2 id="查看最大线程数"><a href="#查看最大线程数" class="headerlink" title="查看最大线程数"></a>查看最大线程数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /proc/sys/kernel/threads-max</div></pre></td></tr></table></figure>
<h2 id="查看系统各个限制的数值"><a href="#查看系统各个限制的数值" class="headerlink" title="查看系统各个限制的数值"></a>查看系统各个限制的数值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ulimit -a</div></pre></td></tr></table></figure>
<h2 id="录制gif"><a href="#录制gif" class="headerlink" title="录制gif"></a>录制gif</h2><p>android 4.4 以上</p>
<h3 id="录制"><a href="#录制" class="headerlink" title="录制"></a>录制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell screenrecord  --bit-rate 2000000 --size 480x800 /sdcard/test.mp4</div></pre></td></tr></table></figure>
<h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb pull /sdcard/test.mp4 ~/Desktop/test.mp4</div></pre></td></tr></table></figure>
<h2 id="修改文件所在组"><a href="#修改文件所在组" class="headerlink" title="修改文件所在组"></a>修改文件所在组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chown -R $USER /usr/local</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chown -R $peter /usr/local</div></pre></td></tr></table></figure>
<h2 id="导出anr文件"><a href="#导出anr文件" class="headerlink" title="导出anr文件"></a>导出anr文件</h2><p>anr 数据保存位置：/data/anr/traces.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb pull /data/anr/traces.txt ~/Desktop/</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="python"><a href="#python" class="headerlink" title="python"></a>python</h1><h2 id="开一个简单的服务器"><a href="#开一个简单的服务器" class="headerlink" title="开一个简单的服务器"></a>开一个简单的服务器</h2><h3 id="python-2-x"><a href="#python-2-x" class="headerlink" title="python 2.x"></a>python 2.x</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python -m SimpleHTTPServer [port]</div></pre></td></tr></table></figure>
<h3 id="python-3-x"><a href="#python-3-x" class="headerlink" title="python 3.x"></a>python 3.x</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python -m http.server [port]</div></pre></td></tr></table></figure>
<hr>
<h1 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ps</div><div class="line">top</div></pre></td></tr></table></figure>
<hr>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><h2 id="ping网速"><a href="#ping网速" class="headerlink" title="ping网速"></a>ping网速</h2><p>-c count<br>在收发指定的count个数目的报文后停止<br>-f<br>尽可能快地发送报文<br>-s packetsize<br>设置要发送的报文大小(单位为字节，最大长度是64k，缺省长度是64)<br>-i wait<br>设置连续报文发送时报文间的发送时间间隔（单位为秒）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ping -c 5 -s 1024 -i 2 www.baidu.com</div></pre></td></tr></table></figure></p>
<p>发送 5次   1024 byte 间隔 2秒 到百度服务器。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/10/加密/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/10/加密/" itemprop="url">
                  加密
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-10T16:23:01+08:00">
                2017-02-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h1><p>采用单钥密码系统的加密方法，同一个密钥可以同时用作信息的加密和解密，这种加密方法称为对称加密，也称为单密钥加密。</p>
<h2 id="AES-加密"><a href="#AES-加密" class="headerlink" title="AES 加密"></a>AES 加密</h2><p>对称密钥加密中最流行的算法之一，Advanced Encryption Standard，安全级别不高的自动登录一般用AES加密，AES加密是比较快的。<br><a href="http://coolshell.cn/articles/3161.html" target="_blank" rel="external">动画演示</a></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><h3 id="生成key"><a href="#生成key" class="headerlink" title="生成key"></a>生成key</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">byte[] key = (SALT2 + username + password).getBytes(&quot;UTF-8&quot;);</div><div class="line">MessageDigest sha = MessageDigest.getInstance(&quot;SHA-1&quot;);</div><div class="line">key = sha.digest(key);</div><div class="line">key = Arrays.copyOf(key, 16); // use only first 128 bit</div><div class="line">SecretKeySpec secret = new SecretKeySpec(key, &quot;AES&quot;);</div></pre></td></tr></table></figure>
<h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/* Encrypt the message. */</div><div class="line">Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);</div><div class="line">cipher.init(Cipher.ENCRYPT_MODE, secret);</div><div class="line">AlgorithmParameters params = cipher.getParameters();</div><div class="line">byte[] iv = params.getParameterSpec(IvParameterSpec.class).getIV();</div><div class="line">byte[] ciphertext = cipher.doFinal(&quot;Hello, World!&quot;.getBytes(&quot;UTF-8&quot;));</div></pre></td></tr></table></figure>
<h3 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/* Decrypt the message, given derived key and initialization vector. */</div><div class="line">Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);</div><div class="line">cipher.init(Cipher.DECRYPT_MODE, secret, new IvParameterSpec(iv));</div><div class="line">String plaintext = new String(cipher.doFinal(ciphertext), &quot;UTF-8&quot;);</div><div class="line">System.out.println(plaintext);</div></pre></td></tr></table></figure>
<hr>
<h1 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h1><p>需要两个密钥来进行加密和解密，这两个秘钥是公开密钥（public key，简称公钥）和私有密钥（private key，简称私钥）。</p>
<h2 id="RSA-加密"><a href="#RSA-加密" class="headerlink" title="RSA 加密"></a>RSA 加密</h2><p>非对称加密,在公开密钥加密和电子商业中RSA被广泛使用，如github 传输到服务器的代码用的ssl 就是 rsa加密，RSA加密是比较慢的。<br>公钥：加密<br>私钥：解密<br><a href="http://blog.csdn.net/bbld_/article/details/38777491" target="_blank" rel="external">详解</a></p>
<hr>
<h1 id="md5散列码"><a href="#md5散列码" class="headerlink" title="md5散列码"></a>md5散列码</h1><p>MD5 是 Message-Digest Algorithm 5（消息摘要算法第五版）的简称。 是一种加密算法。它的返回值是一个32位长度的字符串。<br>md5是散列函数，提取数据的特征，输出是不可逆的散列值，用于代表某信息A而又不暴露信息A的内容。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><h3 id="1-和内容绑定的加密算法，就是说内容变，结果一定变。"><a href="#1-和内容绑定的加密算法，就是说内容变，结果一定变。" class="headerlink" title="1. 和内容绑定的加密算法，就是说内容变，结果一定变。"></a>1. 和内容绑定的加密算法，就是说内容变，结果一定变。</h3><p>这一特点可以用于内容验证，防止内容被攥改。俗称MD5校验。应用非常广泛。<br>如：下载Android 源码后，如果不放心，就可以进行一下MD5校验。</p>
<h4 id="2-MD5-的算法是不可逆的。"><a href="#2-MD5-的算法是不可逆的。" class="headerlink" title="2. MD5 的算法是不可逆的。"></a>2. MD5 的算法是不可逆的。</h4><p>这一特点可用于加密。应用非常广泛。<br>如： 用户的QQ密码，由于安全需要不能明文传输。就可以用MD5加密（或多次加密）后传输和保存密文。<br>android手机的唯一标识，用户不希望明文传输，也可以用MD5加密（或多次加密）后传输和保存密文。</p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">byte[] bytesOfMessage = yourString.getBytes(&quot;UTF-8&quot;);</div><div class="line">MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;);</div><div class="line">byte[] thedigest = md.digest(bytesOfMessage);</div></pre></td></tr></table></figure>
<hr>
<h1 id="base-64"><a href="#base-64" class="headerlink" title="base 64"></a>base 64</h1><p>base64的作用不是加密，而是用来避免“字节”中不能转换成可显示字符的数值。由于某些系统中只能使用ASCII字符。Base64就是用来将非ASCII字符的数据转换成ASCII字符的一种方法。<br>Base64中是一种基于64个可打印字符来表示二进制数据的表示方法。Base64中的可打印字符包括字母A-Z、a-z、数字0-9，这样共有62个字符，此外两个可打印符号在不同的系统中而不同。</p>
<h2 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">String str = &quot;Hello!&quot;;     </div><div class="line"></div><div class="line">// 加密 </div><div class="line">String enToStr = Base64.encodeToString(str.getBytes(), Base64.DEFAULT);  </div><div class="line"> </div><div class="line">// 解密  </div><div class="line">String str = new String(Base64.decode(enToStr.getBytes(), Base64.DEFAULT)));</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/10/android-c/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/10/android-c/" itemprop="url">
                  android-c
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-10T11:45:07+08:00">
                2017-02-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="activity"><a href="#activity" class="headerlink" title="activity"></a>activity</h1><h2 id="activity-launchmode"><a href="#activity-launchmode" class="headerlink" title="activity launchmode"></a>activity launchmode</h2><h3 id="1-standard"><a href="#1-standard" class="headerlink" title="1.standard"></a>1.standard</h3><p>每次都是新的activity对象。</p>
<h3 id="2-singletop"><a href="#2-singletop" class="headerlink" title="2.singletop"></a>2.singletop</h3><p>栈顶单例。<br>特征：如果栈顶有此activity实例，当用startActivity调用此activity时，会复用这个activity，并调用onNewIntent() 刷新intent数据。<br>应用场景：防止一个activity 显示多个实例。</p>
<h3 id="3-singleTask："><a href="#3-singleTask：" class="headerlink" title="3.singleTask："></a>3.singleTask：</h3><p>栈单例。<br>特征：如果栈中有此activity实例，当用startActivity调用此activity时，会复用这个activity，通过clear掉此activity之上的所有activity的方式将此activity置于栈顶，并调用onNewIntent() 刷新intent数据。<br>应用场景：会被多个应用使用的app的main activity。<br>例子: 浏览器<br>操作：打开浏览器，输入某一网址，然后打开设置界面，按home键切出应用。点击微信，点击某一个网页消息进入，点击菜单，选使用浏览器打开。选择刚才的浏览器点击打开，此时会显示新的网页内容，点击back键会退出浏览器。相同的操作，用qq操作，结果一样。</p>
<h3 id="4-singleInstance："><a href="#4-singleInstance：" class="headerlink" title="4.singleInstance："></a>4.singleInstance：</h3><p>系统单例。<br>特征：如果栈中有此activity实例，当用startActivity调用此activity时，会复用这个activity，并调用onNewIntent() 刷新intent数据。<br>应用场景：和任何activity都没有逻辑关系（包括它所在的app）的activity<br>例子：闹钟<br>操作：打开闹钟设置界面，按home键进入微信，此时闹钟响了，进入闹钟提示界面，按返回键，回到微信界面。闹钟提示界面和任何app都没有逻辑关联，包括它自己所在的app。</p>
<h3 id="onNewintent"><a href="#onNewintent" class="headerlink" title="onNewintent()"></a>onNewintent()</h3><p>2，3，4 复用时会调用onNewintent（）</p>
<h2 id="application-task-activity-的关系？"><a href="#application-task-activity-的关系？" class="headerlink" title="application, task, activity 的关系？"></a>application, task, activity 的关系？</h2><p>task是任务的概念 本质是个栈 一个task任务对应一个acivity集合；通过配置activity的Android:taskAffinity来控制。<br>一个task中可以有多个应用的activity。<br>application是应用的概念，一个application可以有多个task任务（多个栈），默认的application里的activity都在一个栈中。</p>
<h2 id="task控制"><a href="#task控制" class="headerlink" title="task控制"></a>task控制</h2><h3 id="android-allowTaskReparenting"><a href="#android-allowTaskReparenting" class="headerlink" title="android:allowTaskReparenting"></a>android:allowTaskReparenting</h3><p>是否允许此activity，回到原来的task栈中，认祖归宗。 默认false，保留在启动task中。如一个应用启动了浏览器web页面activity，如果allowTaskReparenting=true，这个应用退到后台，浏览器启动时会把这个web页面activity移到浏览器的栈中。</p>
<h3 id="android-alwaysRetainTaskState"><a href="#android-alwaysRetainTaskState" class="headerlink" title="android:alwaysRetainTaskState"></a>android:alwaysRetainTaskState</h3><p>是否保持task状态，默认false，是否保留栈列表。true的话会清除task列表。只适用于根activity，其他的Activity都会被忽略。如浏览器mainActivity设置。</p>
<h3 id="android-clearTaskOnLaunch"><a href="#android-clearTaskOnLaunch" class="headerlink" title="android:clearTaskOnLaunch"></a>android:clearTaskOnLaunch</h3><p>启动时是否清除task，默认false。只适用于根activity。不想保存task状态。</p>
<h3 id="android-finishOnTaskLaunch"><a href="#android-finishOnTaskLaunch" class="headerlink" title="android:finishOnTaskLaunch"></a>android:finishOnTaskLaunch</h3><p>这个属性和android:allowReparenting属性相似，不同之处在于allowReparenting属性是重新宿主到有共同affinity的task中，而finishOnTaskLaunch属性是销毁实例。</p>
<h3 id="configChanges"><a href="#configChanges" class="headerlink" title=":configChanges"></a>:configChanges</h3><p>在Activity中添加了 android:configChanges属性，目的是当所指定属性(Configuration Changes)发生改变时，通知程序调用 onConfigurationChanged()函数。</p>
<h3 id="TaskAffinity"><a href="#TaskAffinity" class="headerlink" title="TaskAffinity"></a>TaskAffinity</h3><p>activity所在task栈的标记。是否属于某一逻辑关系task里。</p>
<h2 id="横竖屏名字"><a href="#横竖屏名字" class="headerlink" title="横竖屏名字"></a>横竖屏名字</h2><h3 id="横屏"><a href="#横屏" class="headerlink" title="横屏"></a>横屏</h3><p>landscape风景画。风景画都是横向的，如家里面曾经挂过的黄果树瀑布的那种。</p>
<h3 id="竖屏"><a href="#竖屏" class="headerlink" title="竖屏"></a>竖屏</h3><p>portrait肖像。肖像都是竖向的，如毛主席像。</p>
<h2 id="activity和dialog的关系"><a href="#activity和dialog的关系" class="headerlink" title="activity和dialog的关系"></a>activity和dialog的关系</h2><p>dialog的本质是个Window。<br>虽然dialog的构造函数是Context，但是显示是基于activity。<br>dialog的显示不会触发activity的任何生命周期回调函数。</p>
<h2 id="dialog的dismiss-和cancel-的区别"><a href="#dialog的dismiss-和cancel-的区别" class="headerlink" title="dialog的dismiss()和cancel()的区别"></a>dialog的dismiss()和cancel()的区别</h2><h3 id="dismiss-源码"><a href="#dismiss-源码" class="headerlink" title="dismiss() 源码"></a>dismiss() 源码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/**  </div><div class="line"> * Dismiss this dialog, removing it from the screen. This method can be  </div><div class="line"> * invoked safely from any thread.  Note that you should not override this  </div><div class="line"> * method to do cleanup when the dialog is dismissed, instead implement  </div><div class="line"> * that in &#123;@link #onStop&#125;.  </div><div class="line"> */  </div><div class="line">@Override  </div><div class="line">public void dismiss() &#123;  </div><div class="line">    if (Looper.myLooper() == mHandler.getLooper()) &#123;  </div><div class="line">        dismissDialog();  </div><div class="line">    &#125; else &#123;  </div><div class="line">        mHandler.post(mDismissAction);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="cancel-源码"><a href="#cancel-源码" class="headerlink" title="cancel() 源码"></a>cancel() 源码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/**  </div><div class="line"> * Cancel the dialog.  This is essentially the same as calling &#123;@link #dismiss()&#125;, but it will  </div><div class="line"> * also call your &#123;@link DialogInterface.OnCancelListener&#125; (if registered).  </div><div class="line"> */  </div><div class="line">public void cancel() &#123;  </div><div class="line">    if (!mCanceled &amp;&amp; mCancelMessage != null) &#123;  </div><div class="line">        mCanceled = true;  </div><div class="line">        // Obtain a new message so this dialog can be re-used  </div><div class="line">        Message.obtain(mCancelMessage).sendToTarget();  </div><div class="line">    &#125;  </div><div class="line">    dismiss();  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>从源码可以看出2个方法的效果一样都是让dialog消失， 只是cancel() 多了一个DialogInterface.OnCancelListener的回调。</p>
<h2 id="切换activity时他们的回调函数调用逻辑"><a href="#切换activity时他们的回调函数调用逻辑" class="headerlink" title="切换activity时他们的回调函数调用逻辑"></a>切换activity时他们的回调函数调用逻辑</h2><p>分别监听两个activity的 onCreate onStart onRestart onResume onPause onStop onDestroy 回调函数。<br><a href="http://download.csdn.net/detail/javalive09/6855725" target="_blank" rel="external">demo</a></p>
<h3 id="打开act1"><a href="#打开act1" class="headerlink" title="打开act1"></a>打开act1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">01-16 15:54:32.374: I/peter(13244): ACT1-onCreate  </div><div class="line">01-16 15:54:32.374: I/peter(13244): ACT1-onStart  </div><div class="line">01-16 15:54:32.374: I/peter(13244): ACT1-onResume</div></pre></td></tr></table></figure>
<h3 id="打开act2"><a href="#打开act2" class="headerlink" title="打开act2"></a>打开act2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">01-16 15:55:29.509: I/peter(13244): ACT1-onPause  </div><div class="line">01-16 15:55:29.524: I/peter(13244): ACT2-onCreate  </div><div class="line">01-16 15:55:29.524: I/peter(13244): ACT2-onStart  </div><div class="line">01-16 15:55:29.524: I/peter(13244): ACT2-onResume  </div><div class="line">01-16 15:55:29.604: I/peter(13244): ACT1-onStop</div></pre></td></tr></table></figure>
<h3 id="关闭act2"><a href="#关闭act2" class="headerlink" title="关闭act2"></a>关闭act2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">01-16 15:56:11.614: I/peter(13244): ACT2-onPause  </div><div class="line">01-16 15:56:11.639: I/peter(13244): ACT1-onRestart  </div><div class="line">01-16 15:56:11.639: I/peter(13244): ACT1-onStart  </div><div class="line">01-16 15:56:11.639: I/peter(13244): ACT1-onResume  </div><div class="line">01-16 15:56:16.714: I/peter(13244): ACT2-onStop  </div><div class="line">01-16 15:56:16.714: I/peter(13244): ACT2-onDestroy</div></pre></td></tr></table></figure>
<p>为什么会出现这种2个activity交叉调用的逻辑呢？<br>为什么不全部回调完当前的activity的函数。再回调要显示的activity函数。这样的逻辑不是更简单明了么。</p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>增加动画显示的时间如：用5000毫秒来显示动画<br>执行上面的3 步骤时发现如下现象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">01-16 16:07:01.544: I/peter(13244): ACT2-onPause  </div><div class="line">01-16 16:07:01.569: I/peter(13244): ACT1-onRestart  </div><div class="line">01-16 16:07:01.569: I/peter(13244): ACT1-onStart  </div><div class="line">01-16 16:07:01.569: I/peter(13244): ACT1-onResume</div></pre></td></tr></table></figure></p>
<p>过了很久直到动画显示完成才出现下面的log。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">01-16 16:07:06.649: I/peter(13244): ACT2-onStop  </div><div class="line">01-16 16:07:06.649: I/peter(13244): ACT2-onDestroy</div></pre></td></tr></table></figure></p>
<h3 id="结论-1"><a href="#结论-1" class="headerlink" title="结论"></a>结论</h3><p>activity支持动画切换造成了这种逻辑。<br>如果activity切换动画的时间很长。如果直接全部回调完当前的activity的函数。再回调要显示的activity函数。<br>会造成这种可能：当前的activity 它的ondestory() 被调用了。view 被虚拟机回收了。但是它还再做动画。这时null 空指针出现了。于是软件崩溃。</p>
<h2 id="同一个程序不同activity放入不同的栈中"><a href="#同一个程序不同activity放入不同的栈中" class="headerlink" title="同一个程序不同activity放入不同的栈中"></a>同一个程序不同activity放入不同的栈中</h2><p>intent中加入flag  Intent.FLAG_ACTIVITY_NEW_TASK 标记。即可</p>
<h2 id="不同程序的activity放入同一个栈中"><a href="#不同程序的activity放入同一个栈中" class="headerlink" title="不同程序的activity放入同一个栈中"></a>不同程序的activity放入同一个栈中</h2><p>activity 标签中加入：<br>android:allowTaskReparenting=”true”<br>android:taskAffinity=”same”</p>
<h2 id="activity状态的保存"><a href="#activity状态的保存" class="headerlink" title="activity状态的保存"></a>activity状态的保存</h2><p>栈底的activity 在系统内存不足的时候会被回收，规则是越在栈底越容易被回收。那么再次启动activity的时候就会出现问题。<br>Android系统提供了activity状态保存的机制。</p>
<h3 id="保存"><a href="#保存" class="headerlink" title="保存"></a>保存</h3><p>重写onSaveInstanceState(Bundle outState) outState 保存状态值。</p>
<h3 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h3><p>重写onRestoreInstanceState(Bundle savedInstanceState)通过 savedInstanceState 或onCreate()中通过intent获取之前保存的值。</p>
<h2 id="splashview-闪屏界面实现的逻辑"><a href="#splashview-闪屏界面实现的逻辑" class="headerlink" title="splashview 闪屏界面实现的逻辑"></a>splashview 闪屏界面实现的逻辑</h2><p>Android 软件有时初始化时有耗时操作，很影响体验。一般的做法是加一层splash view。加载完成再进入操作界面。这样用户可以在体验上感觉更好一些。主要逻辑。<br>是在初始化耗时操作时，显示splash view。 耗时操作结束，显示操作界面。<br><a href="http://download.csdn.net/detail/javalive09/6852655" target="_blank" rel="external">demo</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@Override  </div><div class="line">protected void onCreate(Bundle savedInstanceState) &#123;  </div><div class="line">    super.onCreate(savedInstanceState);  </div><div class="line">      </div><div class="line">    setContentView(R.layout.splash);//闪屏界面  </div><div class="line">      </div><div class="line">    IdleHandler handler = new IdleHandler() &#123;  </div><div class="line">  </div><div class="line">        @Override  </div><div class="line">        public boolean queueIdle() &#123;  </div><div class="line">            setContentView(R.layout.activity_main);//操作界面  </div><div class="line">              </div><div class="line">            //long time consuming Operating  </div><div class="line">            longTime();//耗时操作  </div><div class="line">            return false;  </div><div class="line">        &#125;  </div><div class="line">          </div><div class="line">    &#125;;  </div><div class="line">    Looper.myQueue().addIdleHandler(handler);  </div><div class="line">      </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="activity中addContentView和setContentView的区别"><a href="#activity中addContentView和setContentView的区别" class="headerlink" title="activity中addContentView和setContentView的区别"></a>activity中addContentView和setContentView的区别</h2><h3 id="setContentView"><a href="#setContentView" class="headerlink" title="setContentView"></a>setContentView</h3><p>逻辑在PhoneWindow 类中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Override  </div><div class="line">public void setContentView(int layoutResID) &#123;  </div><div class="line">    if (mContentParent == null) &#123;  </div><div class="line">        installDecor();  </div><div class="line">    &#125; else &#123;  </div><div class="line">        mContentParent.removeAllViews();  </div><div class="line">    &#125;  </div><div class="line">    mLayoutInflater.inflate(layoutResID, mContentParent);  </div><div class="line">    final Callback cb = getCallback();  </div><div class="line">    if (cb != null &amp;&amp; !isDestroyed()) &#123;  </div><div class="line">        cb.onContentChanged();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果多次调用setContentView ，则之后每次都会清空 mContentParent 容器。然后组装资源layoutResID。</p>
<h3 id="addContentView"><a href="#addContentView" class="headerlink" title="addContentView"></a>addContentView</h3><p>逻辑也在PhoneWindow 类中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@Override  </div><div class="line">public void addContentView(View view, ViewGroup.LayoutParams params) &#123;  </div><div class="line">    if (mContentParent == null) &#123;  </div><div class="line">        installDecor();  </div><div class="line">    &#125;  </div><div class="line">    mContentParent.addView(view, params);  </div><div class="line">    final Callback cb = getCallback();  </div><div class="line">    if (cb != null &amp;&amp; !isDestroyed()) &#123;  </div><div class="line">        cb.onContentChanged();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果多次调用addContentView ，则之后每次都会将view添加到mContentParent 容器中。最后产生view 的叠加效果。</p>
<h3 id="结论："><a href="#结论：" class="headerlink" title="结论："></a>结论：</h3><p>调用 setContentView 。设置时会清空容器再添加 view。无view叠加效果<br>调用addContentView 。直接添加到view容器中，有view叠加效果。</p>
<h2 id="隐式Intent"><a href="#隐式Intent" class="headerlink" title="隐式Intent"></a>隐式Intent</h2><h3 id="隐式intent的作用"><a href="#隐式intent的作用" class="headerlink" title="隐式intent的作用"></a>隐式intent的作用</h3><p>1.在不暴露类的情况下，可以让其他组件或程序调用此组组建（在filter中过滤相关intent，只有满足其条件才触发）。<br>2.注册给系统列表，使系统打开对应文件或链接时，该程序出现在打开列表中。如：浏览器，图片查看器。 </p>
<h3 id="隐式intent的3个子节点"><a href="#隐式intent的3个子节点" class="headerlink" title="隐式intent的3个子节点"></a>隐式intent的3个子节点</h3><h4 id="action"><a href="#action" class="headerlink" title="action"></a>action</h4><p>最关键的一个表示行为的属性，如果要启用隐式意图，AndroidManifest.xml中filter的action集 中必须包含此action。</p>
<h4 id="category"><a href="#category" class="headerlink" title="category"></a>category</h4><p>对action的辅助说明。<br>如果启用隐式意图的intent对象中不写category，系统会加入默认的catagory：Android.intent.category.DEFAULT。AndroidManifest.xml中filter的category集合中必须包含<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</div></pre></td></tr></table></figure></p>
<p>程序的入口activity除外。</p>
<h4 id="data"><a href="#data" class="headerlink" title="data"></a>data</h4><p>对action的辅助说明。data属性由两部分构成 ：数据URI 和 数据MIME type; data内容往往和action有关。</p>
<h2 id="IntentFilter-中-的android-priority-的含义"><a href="#IntentFilter-中-的android-priority-的含义" class="headerlink" title="IntentFilter 中 的android:priority 的含义"></a>IntentFilter 中 的android:priority 的含义</h2><p>关于priority 这个属性的描述 ，google 官方文档如下：<br><a href="http://developer.android.com/guide/topics/manifest/intent-filter-element.html" target="_blank" rel="external">官方文档</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">android:priority  </div><div class="line">The priority that should be given to the parent component with regard to handling intents of the type described by the filter. This attribute has meaning for both activities and broadcast receivers:  </div><div class="line">It provides information about how able an activity is to respond to an intent that matches the filter, relative to other activities that could also respond to the intent. When an intent could be handled by multiple activities with different priorities, Android will consider only those with higher priority values as potential targets for the intent.  </div><div class="line">It controls the order in which broadcast receivers are executed to receive broadcast messages. Those with higher priority values are called before those with lower values. (The order applies only to synchronous messages; it&apos;s ignored for asynchronous messages.)  </div><div class="line">Use this attribute only if you really need to impose a specific order in which the broadcasts are received, or want to force Android to prefer one activity over others.  </div><div class="line"></div><div class="line">The value must be an integer, such as &quot;100&quot;. Higher numbers have a higher priority. The default value is 0. The value must be greater than -1000 and less than 1000.  </div><div class="line">  </div><div class="line">Also see setPriority().</div></pre></td></tr></table></figure></p>
<p>priority优先级仅用于描述控件的intent的filter的类型。这个属性只对activity和receivers是有意义的。priority 必须是整数，默认是0 范围是[-1000, 1000]</p>
<h3 id="隐式调用activity的情况"><a href="#隐式调用activity的情况" class="headerlink" title="隐式调用activity的情况"></a>隐式调用activity的情况</h3><p>如果多个activity 满足响应 的条件，系统只会触发 priority 高的那个activity。</p>
<h3 id="有序广播发出的情况"><a href="#有序广播发出的情况" class="headerlink" title="有序广播发出的情况"></a>有序广播发出的情况</h3><p>如果多个receiver满足响应的条件，系统会优先触发prioriyt搞的那个receiver。</p>
<h2 id="activity-ondestory-的调用时机"><a href="#activity-ondestory-的调用时机" class="headerlink" title="activity ondestory()的调用时机"></a>activity ondestory()的调用时机</h2><h3 id="调用finish"><a href="#调用finish" class="headerlink" title="调用finish()"></a>调用finish()</h3><h3 id="触发back键"><a href="#触发back键" class="headerlink" title="触发back键"></a>触发back键</h3><h3 id="触发home键，内存紧张。"><a href="#触发home键，内存紧张。" class="headerlink" title="触发home键，内存紧张。"></a>触发home键，内存紧张。</h3><h2 id="关闭activity的方法"><a href="#关闭activity的方法" class="headerlink" title="关闭activity的方法"></a>关闭activity的方法</h2><ol>
<li>点击back键</li>
<li>调用finish();</li>
<li>clear top的方式 startactivity <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent(getActivity(), TrashClearMainAcitivity.class);  </div><div class="line">intent.putExtra(TrashClearMainAcitivity.CLEARTYPE, 1);  </div><div class="line">intent.setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);  </div><div class="line">intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);  </div><div class="line">Utils.startActivity(getActivity(), intent);</div></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>1.长期存在的后台操作（无界面交互）。<br>2.公用的（context 上下文对象都可以操作）。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>1.service默认和应用主线程在同一进程。<br>2.Android：process=“:xxx” service是应用程序私有的，并且自己单独处在一个进程。<br>3.android：process=“xxx”  service是global的，并且自己单独处在一个进程。</p>
<h2 id="service重启"><a href="#service重启" class="headerlink" title="service重启"></a>service重启</h2><p>通过onStartCommand 方法的return 值来实现。<br>1.service.START_STICKY  被杀后重启。默认。<br>2.service.START_NO_STICKY 被杀后不重启。<br>3.service.START_REDELIVER_INTENT 被杀后重启。并传递 data intent。</p>
<h3 id="前台运行"><a href="#前台运行" class="headerlink" title="前台运行"></a>前台运行</h3><p>startForeGround<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Notification note = new Notification(R.drawable.ic_launcher, &quot;Video Service&quot;,</div><div class="line">        System.currentTimeMillis());</div><div class="line">note.setLatestEventInfo(this, &quot;Video Service&quot;, null, null);</div><div class="line">note.flags = Notification.FLAG_NO_CLEAR;</div><div class="line">startForeground(1, note);</div></pre></td></tr></table></figure></p>
<h2 id="IntentService的应用场景"><a href="#IntentService的应用场景" class="headerlink" title="IntentService的应用场景"></a>IntentService的应用场景</h2><p>开启一个新的IntentService 就会在它内部新建一个Thread 并在其上加了一个Looper。执行完毕后自动关闭service。<br>IntentService 被用于执行需要排队执行的一串耗时操作。<br>IntentService应用的关键点是Looper。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">public class SendKeyCodeService extends IntentService &#123;</div><div class="line"></div><div class="line">    private static final String NAME = &quot;keycode&quot;;</div><div class="line"></div><div class="line">    public static final String KEYCODE = &quot;send_keycode&quot;;</div><div class="line"></div><div class="line">    private static final String PATH_KEY_FILE = &quot;/sys/class/mac_accessory/virtual_key/send_virtual_key&quot;;</div><div class="line"></div><div class="line">    public SendKeyCodeService() &#123;</div><div class="line">        super(NAME);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onHandleIntent(Intent intent) &#123;</div><div class="line">        int keyCode = intent.getIntExtra(KEYCODE, 0);</div><div class="line">        if(keyCode != 0) &#123;</div><div class="line">            sendKey(keyCode);</div><div class="line">        &#125;</div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(200);</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void sendKey(int keyCode) &#123;</div><div class="line">        try &#123;</div><div class="line">            PrintWriter out = new PrintWriter(new BufferedWriter(new FileWriter(PATH_KEY_FILE, true)));</div><div class="line">            out.println(keyCode);</div><div class="line">            out.close();</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            //exception handling left as an exercise for the reader</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Service和activity如何通讯"><a href="#Service和activity如何通讯" class="headerlink" title="Service和activity如何通讯"></a>Service和activity如何通讯</h2><h3 id="本地Service"><a href="#本地Service" class="headerlink" title="本地Service"></a>本地Service</h3><h4 id="1-通过startService-intent。"><a href="#1-通过startService-intent。" class="headerlink" title="1. 通过startService intent。"></a>1. 通过startService intent。</h4><h4 id="2-通过bindeService-中间类binder-获取service引用来调用。"><a href="#2-通过bindeService-中间类binder-获取service引用来调用。" class="headerlink" title="2. 通过bindeService 中间类binder 获取service引用来调用。"></a>2. 通过bindeService 中间类binder 获取service引用来调用。</h4><h4 id="3-通过broadcast广播-intent。"><a href="#3-通过broadcast广播-intent。" class="headerlink" title="3. 通过broadcast广播 intent。"></a>3. 通过broadcast广播 intent。</h4><h3 id="远程Service"><a href="#远程Service" class="headerlink" title="远程Service"></a>远程Service</h3><h4 id="1-通过startService-intent。-1"><a href="#1-通过startService-intent。-1" class="headerlink" title="1. 通过startService intent。"></a>1. 通过startService intent。</h4><h4 id="2-通过bindeService-然后使用AIDL进行相互通讯"><a href="#2-通过bindeService-然后使用AIDL进行相互通讯" class="headerlink" title="2. 通过bindeService 然后使用AIDL进行相互通讯"></a>2. 通过bindeService 然后使用AIDL进行相互通讯</h4><h5 id="写aidl文件，定义要通讯的接口。"><a href="#写aidl文件，定义要通讯的接口。" class="headerlink" title="写aidl文件，定义要通讯的接口。"></a>写aidl文件，定义要通讯的接口。</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">interface IMyAidlInterface &#123;</div><div class="line">   String getName();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="service-中提供aidl定义接口xxx-stub-的实现类。"><a href="#service-中提供aidl定义接口xxx-stub-的实现类。" class="headerlink" title="service 中提供aidl定义接口xxx.stub 的实现类。"></a>service 中提供aidl定义接口xxx.stub 的实现类。</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class MyService extends Service &#123;</div><div class="line"></div><div class="line">    public MyService() &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        return new MyBinder();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    class MyBinder extends IMyAidlInterface.Stub &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public String getName() throws RemoteException &#123;</div><div class="line">            return &quot;test&quot;;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>c. acivity 获取xxx接口引用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private IMyAidlInterface iMyAidlInterface;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        bindService(new Intent(&quot;cc.abto.server&quot;), new ServiceConnection()&#123;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line"></div><div class="line">                iMyAidlInterface = IMyAidlInterface.Stub.asInterface(service);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;, BIND_AUTO_CREATE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void onClick(View view) &#123;</div><div class="line">        try &#123;</div><div class="line">            Toast.makeText(MainActivity.this, iMyAidlInterface.getName(), Toast.LENGTH_SHORT).show();</div><div class="line">        &#125; catch (RemoteException e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="3-通过broadcast广播-intent。-1"><a href="#3-通过broadcast广播-intent。-1" class="headerlink" title="3. 通过broadcast广播 intent。"></a>3. 通过broadcast广播 intent。</h4><h4 id="4-通过messager通信-最方便"><a href="#4-通过messager通信-最方便" class="headerlink" title="4. 通过messager通信(最方便)"></a>4. 通过messager通信(最方便)</h4><h5 id="service-构建messager"><a href="#service-构建messager" class="headerlink" title="service 构建messager"></a>service 构建messager</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">public class MyService extends Service &#123;</div><div class="line"></div><div class="line">    public final static String TAG = &quot;MyService&quot;;</div><div class="line"></div><div class="line">    public final static int SERVICEID = 0x0001;</div><div class="line">    private Messenger messenger = new Messenger(new Handler() &#123;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            super.handleMessage(msg);</div><div class="line">            if (msg.arg1 == SERVICEID) &#123;</div><div class="line">              	//接受从客户端传来的消息</div><div class="line">                Log.d(TAG, &quot;客服端传来的消息===&gt;&gt;&gt;&gt;&gt;&gt;&quot;);</div><div class="line">                String str = (String) msg.getData().get(&quot;content&quot;);</div><div class="line">                Log.d(TAG, str);</div><div class="line"></div><div class="line">                //发送数据给客户端</div><div class="line">                Message msgTo = Message.obtain();</div><div class="line">                msgTo.arg1 = 0X0002;</div><div class="line">                Bundle bundle = new Bundle();</div><div class="line">                bundle.putString(&quot;content&quot;, &quot;我是从服务器来的字符串&quot;);</div><div class="line">                msgTo.setData(bundle);</div><div class="line">                try &#123;</div><div class="line">                    //注意，这里把数据从服务器发出了</div><div class="line">                    msg.replyTo.send(msgTo);</div><div class="line">                &#125; catch (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onCreate() &#123;</div><div class="line">        super.onCreate();</div><div class="line">        Log.i(TAG, &quot;onCreat&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        return messenger.getBinder();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="activity-构建messager"><a href="#activity-构建messager" class="headerlink" title="activity 构建messager"></a>activity 构建messager</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">     public final static String TAG = &quot;MainActivity&quot;;</div><div class="line">     public final static int ACTIVITYID = 0X0002;</div><div class="line">     //客户端的Messnger</div><div class="line">     private Messenger aMessenger = new Messenger(new Handler() &#123;</div><div class="line">         @Override</div><div class="line">         public void handleMessage(Message msg) &#123;</div><div class="line">             super.handleMessage(msg);</div><div class="line">             if (msg.arg1 == ACTIVITYID) &#123;</div><div class="line">              //客户端接受服务端传来的消息</div><div class="line">                 Log.d(TAG, &quot;服务端传来了消息=====&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;);</div><div class="line">                 String str = (String) msg.getData().get(&quot;content&quot;);</div><div class="line">                 Log.d(TAG, str);</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">     &#125;);</div><div class="line"></div><div class="line">    //服务端传来的Messenger</div><div class="line">     Messenger sMessenger;</div><div class="line"></div><div class="line">     ServiceConnection serviceConnection = new ServiceConnection() &#123;</div><div class="line">         @Override</div><div class="line">         public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">             sMessenger = new Messenger(service);</div><div class="line"></div><div class="line">             Message message = Message.obtain();</div><div class="line">             message.arg1 = 0x0001;</div><div class="line">             //注意这里，把Activity的Messenger赋值给了message中，当然可能你已经发现这个就是Service中我们调用的msg.replyTo了。</div><div class="line">             message.replyTo = aMessenger;</div><div class="line"></div><div class="line">             Bundle bundle = new Bundle();</div><div class="line">             bundle.putString(&quot;content&quot;, &quot;我就是Activity传过来的字符串&quot;);</div><div class="line">             message.setData(bundle);</div><div class="line"></div><div class="line">             try &#123;</div><div class="line">               //消息从客户端发出</div><div class="line">                 sMessenger.send(message);</div><div class="line">             &#125; catch (RemoteException e) &#123;</div><div class="line">                 e.printStackTrace();</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         @Override</div><div class="line">         public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line">             Log.e(TAG, &quot;连接Service失败&quot;);</div><div class="line">         &#125;</div><div class="line">     &#125;;</div><div class="line"></div><div class="line">     @Override</div><div class="line">     protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">         super.onCreate(savedInstanceState);</div><div class="line">         setContentView(R.layout.activity_main);</div><div class="line">         startAndBindService();</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     private void startAndBindService() &#123;</div><div class="line">         Intent service = new Intent(MainActivity.this, MyService.class);</div><div class="line">         startService(service);</div><div class="line">         bindService(service, serviceConnection, Context.BIND_AUTO_CREATE);</div><div class="line">     &#125;</div><div class="line"></div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<hr>
<h1 id="BroadcastReceiver"><a href="#BroadcastReceiver" class="headerlink" title="BroadcastReceiver"></a>BroadcastReceiver</h1><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><h3 id="根据注册方式："><a href="#根据注册方式：" class="headerlink" title="根据注册方式："></a>根据注册方式：</h3><p>1.代码注册<br>2.manifest文件注册</p>
<h3 id="按是否有序："><a href="#按是否有序：" class="headerlink" title="按是否有序："></a>按是否有序：</h3><p>1.有序广播，如短信，电话。 Android:priority = “1000” (-1000 ~ 1000) 由高到低 可以拦截广播。<br>2.无序广播，无优先级。</p>
<blockquote>
<p>注：广播启动activity必须加入FLAG_ACTIVITY_NEW_TASK标记。</p>
</blockquote>
<h1 id="进程的优先级"><a href="#进程的优先级" class="headerlink" title="进程的优先级"></a>进程的优先级</h1><h2 id="1-前台进程"><a href="#1-前台进程" class="headerlink" title="1.前台进程"></a>1.前台进程</h2><p>正交互的前台显示的进程。</p>
<h2 id="2-可见进程"><a href="#2-可见进程" class="headerlink" title="2.可见进程"></a>2.可见进程</h2><p>半透明的activity后面的activity。</p>
<h2 id="3-服务进程"><a href="#3-服务进程" class="headerlink" title="3.服务进程"></a>3.服务进程</h2><p>service</p>
<h2 id="4-后台进程"><a href="#4-后台进程" class="headerlink" title="4.后台进程"></a>4.后台进程</h2><p>按下Home键</p>
<h2 id="5-Empty进程"><a href="#5-Empty进程" class="headerlink" title="5.Empty进程"></a>5.Empty进程</h2><p>按下back键</p>
<hr>
<h1 id="Android-中的一些时间"><a href="#Android-中的一些时间" class="headerlink" title="Android 中的一些时间"></a>Android 中的一些时间</h1><h2 id="1-Toast-NotificationManagerService-java"><a href="#1-Toast-NotificationManagerService-java" class="headerlink" title="1. Toast  (NotificationManagerService.java)"></a>1. Toast  (NotificationManagerService.java)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Toast.LENGTH_SHORT  2000ms // 2秒</div><div class="line">Toast.LENGTH_LONG    3500ms // 3.5秒</div></pre></td></tr></table></figure>
<h2 id="2-ANR-ActivityManagerService-java"><a href="#2-ANR-ActivityManagerService-java" class="headerlink" title="2. ANR   (ActivityManagerService.java)"></a>2. ANR   (ActivityManagerService.java)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">KeyDispatchTimeout   KEY_DISPATCHING_TIMEOUT = 5 * 1000  // 5 秒</div><div class="line">BroadcastTimeout     BROADCAST_FG_TIMEOUT = 10 * 1000     // 10 秒</div><div class="line">ServiceTimeout       // 20 秒</div></pre></td></tr></table></figure>
<hr>
<h1 id="android中如何调用已经安装的某个应用"><a href="#android中如何调用已经安装的某个应用" class="headerlink" title="android中如何调用已经安装的某个应用"></a>android中如何调用已经安装的某个应用</h1><h2 id="1-使用logcat过滤出-ActivityManager的log"><a href="#1-使用logcat过滤出-ActivityManager的log" class="headerlink" title="1.使用logcat过滤出 ActivityManager的log"></a>1.使用logcat过滤出 ActivityManager的log</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb -s logcat | grep &quot;ActivityManager&quot;</div></pre></td></tr></table></figure>
<h2 id="2-点击应用icon-触发应用"><a href="#2-点击应用icon-触发应用" class="headerlink" title="2.点击应用icon 触发应用"></a>2.点击应用icon 触发应用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I/ActivityManager(  449): START u0 &#123;act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] flg=0x10200000 cmp=com.android.calendar/.AllInOneActivity&#125; from pid 5180  </div><div class="line">cmp = com.android.calendar/.AllInOneActivity    是包名和启动类的名字</div></pre></td></tr></table></figure>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><h3 id="1-根据包名和触发类的intent启动："><a href="#1-根据包名和触发类的intent启动：" class="headerlink" title="1. 根据包名和触发类的intent启动："></a>1. 根据包名和触发类的intent启动：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">intent = new Intent();  </div><div class="line">intent.setClassName(&quot;com.android.calendar&quot;,  </div><div class="line">        &quot;com.android.calendar.AllInOneActivity&quot;);  </div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
<h3 id="2-根据包名使用activitymanager-启动："><a href="#2-根据包名使用activitymanager-启动：" class="headerlink" title="2. 根据包名使用activitymanager 启动："></a>2. 根据包名使用activitymanager 启动：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">intent = this.getPackageManager().getLaunchIntentForPackage(  </div><div class="line">        &quot;com.android.calendar&quot;);  </div><div class="line">if (intent != null) &#123;  </div><div class="line">    startActivity(intent);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h1 id="手机序列号和IMEI号的区别"><a href="#手机序列号和IMEI号的区别" class="headerlink" title="手机序列号和IMEI号的区别"></a>手机序列号和IMEI号的区别</h1><h2 id="手机序列号："><a href="#手机序列号：" class="headerlink" title="手机序列号："></a>手机序列号：</h2><p>SN码是Serial Number的缩写，有时也叫SerialNo，也就是产品序列号，产品序列是为了验证“产品的合法身份”而引入的一个概念，它是用来保障用<br>户的正 版权益，享受合法服务的；一套正版的产品只对应一组产品序列号。别称：机器码、认证码、注册申请码等。</p>
<h2 id="IMEI"><a href="#IMEI" class="headerlink" title="IMEI:"></a>IMEI:</h2><p>IMEI（International Mobile Equipment Identity）是移动设备国际身份码的缩写。<br>IMEI码由GSM（Global System for Mobile Communications，全球移动通信协会）统一分配，授权BABT（British approvals Board of                                Telecommunications，英国通信认证管理委员会）审受。<br>IMEI 的主要用途是提供信息给网络系统，让系统知道哪个手机在收发信号。主要目的是防止被窃的手机登入网络并监听防止手机使用者任意干扰网络。</p>
<hr>
<h1 id="getDimension-getDimensionPixelOffset-getDimensionPixelSize-的区别"><a href="#getDimension-getDimensionPixelOffset-getDimensionPixelSize-的区别" class="headerlink" title="getDimension(), getDimensionPixelOffset(), getDimensionPixelSize()的区别"></a>getDimension(), getDimensionPixelOffset(), getDimensionPixelSize()的区别</h1><p>Resources中的这三个方法很让人迷惑。究竟有什么区别。</p>
<h2 id="1-getDimension"><a href="#1-getDimension" class="headerlink" title="1. getDimension()"></a>1. getDimension()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public float getDimension(int id) throws NotFoundException &#123;  </div><div class="line">    synchronized (mTmpValue) &#123;  </div><div class="line">        TypedValue value = mTmpValue;  </div><div class="line">        getValue(id, value, true);  </div><div class="line">        if (value.type == TypedValue.TYPE_DIMENSION) &#123;  </div><div class="line">            return TypedValue.complexToDimension(value.data, mMetrics);  </div><div class="line">        &#125;  </div><div class="line">        throw new NotFoundException(  </div><div class="line">                &quot;Resource ID #0x&quot; + Integer.toHexString(id) + &quot; type #0x&quot;  </div><div class="line">                + Integer.toHexString(value.type) + &quot; is not valid&quot;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终会调用TypedValue.complexToDimension()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public static float complexToDimension(int data, DisplayMetrics metrics) &#123;  </div><div class="line">    return applyDimension(  </div><div class="line">        (data&gt;&gt;COMPLEX_UNIT_SHIFT)&amp;COMPLEX_UNIT_MASK,  </div><div class="line">        complexToFloat(data),  </div><div class="line">        metrics);  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="2-getDimensionPixelOffset"><a href="#2-getDimensionPixelOffset" class="headerlink" title="2. getDimensionPixelOffset()"></a>2. getDimensionPixelOffset()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public int getDimensionPixelOffset(int id) throws NotFoundException &#123;  </div><div class="line">    synchronized (mTmpValue) &#123;  </div><div class="line">        TypedValue value = mTmpValue;  </div><div class="line">        getValue(id, value, true);  </div><div class="line">        if (value.type == TypedValue.TYPE_DIMENSION) &#123;  </div><div class="line">            return TypedValue.complexToDimensionPixelOffset(  </div><div class="line">                    value.data, mMetrics);  </div><div class="line">        &#125;  </div><div class="line">        throw new NotFoundException(  </div><div class="line">                &quot;Resource ID #0x&quot; + Integer.toHexString(id) + &quot; type #0x&quot;  </div><div class="line">                + Integer.toHexString(value.type) + &quot; is not valid&quot;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终会调用TypedValue.complexToDimensionPixelOffset()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public static int complexToDimensionPixelOffset(int data,  </div><div class="line">        DisplayMetrics metrics) &#123;  </div><div class="line">    return (int)applyDimension(  </div><div class="line">            (data&gt;&gt;COMPLEX_UNIT_SHIFT)&amp;COMPLEX_UNIT_MASK,  </div><div class="line">            complexToFloat(data),  </div><div class="line">            metrics);  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="3-complexToDimensionPixelSize"><a href="#3-complexToDimensionPixelSize" class="headerlink" title="3. complexToDimensionPixelSize()"></a>3. complexToDimensionPixelSize()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public int getDimensionPixelSize(int id) throws NotFoundException &#123;  </div><div class="line">    synchronized (mTmpValue) &#123;  </div><div class="line">        TypedValue value = mTmpValue;  </div><div class="line">        getValue(id, value, true);  </div><div class="line">        if (value.type == TypedValue.TYPE_DIMENSION) &#123;  </div><div class="line">            return TypedValue.complexToDimensionPixelSize(  </div><div class="line">                    value.data, mMetrics);  </div><div class="line">        &#125;  </div><div class="line">        throw new NotFoundException(  </div><div class="line">                &quot;Resource ID #0x&quot; + Integer.toHexString(id) + &quot; type #0x&quot;  </div><div class="line">                + Integer.toHexString(value.type) + &quot; is not valid&quot;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终会调用TypedValue.complexToDimensionPixelSize()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public static int complexToDimensionPixelSize(int data,  </div><div class="line">        DisplayMetrics metrics) &#123;  </div><div class="line">    final float value = complexToFloat(data);  </div><div class="line">    final float f = applyDimension(  </div><div class="line">            (data&gt;&gt;COMPLEX_UNIT_SHIFT)&amp;COMPLEX_UNIT_MASK,  </div><div class="line">            value,  </div><div class="line">            metrics);  </div><div class="line">    final int res = (int)(f+0.5f);  </div><div class="line">    if (res != 0) return res;  </div><div class="line">    if (value == 0) return 0;  </div><div class="line">    if (value &gt; 0) return 1;  </div><div class="line">    return -1;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="结论-2"><a href="#结论-2" class="headerlink" title="结论"></a>结论</h2><p>这3个方法在resources.Java中逻辑一致，只是最终调用的方法有所不同对比3个方法可以发现<br>getDimension() 返回值是的float大小。<br>getDimensionPixelOffset() 返回值是将 getDimension() 强转成int 的值。（强转）<br>getDimensionPixelSize() 返回值是将getDimension()+0.5 再强转成int的值。（4舍5入）<br>这3个方法的本质区别就是大小精确度的差别。想要大一点就用getDimensionPixelSize(),  想要精确点就用getDimension(), 想要小一点就用getDimensionPixelOffset()</p>
<hr>
<h1 id="TargetApi的作用"><a href="#TargetApi的作用" class="headerlink" title="@TargetApi的作用"></a>@TargetApi的作用</h1><h2 id="官方文档描述"><a href="#官方文档描述" class="headerlink" title="官方文档描述"></a>官方文档描述</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">As you can see, lint now has a database of the full Android API such that it knows precisely which version each API call was introduced in. If it detects that you are attempting to call a method which is not available in all versions you are trying to support, it will warn you with messages like the above.</div></pre></td></tr></table></figure>
<p>正如你所看到的, lint现 在有完整的Android API的一个数据库,这样它清楚地知道哪个版本的哪一个API调用了。如果它检测到你正试图调用一个方法不是在所有版本都可用，那么它将提醒给你上面的消息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Of course, if you&apos;re building your project with the same version of Android as your oldest support version, the compiler will complain if it finds an API call it can&apos;t resolve. However, that approach has some downsides. In particular, you may want to access newer APIs on platforms where they are available. If you&apos;re compiling against the oldest version of the platform, you would need to use reflection to access all the new APIs, which can be really cumbersome, especially if you have a lot of code using the newer APIs.</div><div class="line">The way most developers get around this is to actually use a newer build target, which means you can access all the new APIs directly. You then add some code checks to make sure that the code path which calls the newer APIs is only reached when running on a version which supports it.</div></pre></td></tr></table></figure></p>
<p>当然,如果您编译的项目的版本和支持的最低支持的版本相同, 编译器会提示找不到相关API。然而,这种方法有一些缺点。特别是,您可能希望访问新的平台上可用的api。如果你对老版本的编译平台,您将需要使用反射来访问所有的新api,可真的麻烦,特别是如果你有很多的代码使用新的api。</p>
<p>实际上大多数开发人员解决这个问题的方法是使用更高的版本来编译这个项目,这意味着您可以直接访问所有的新api。然后添加一些代码检查,以确保调用的代码路径上运行时达成的新api只是一个版本支持它。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">However, when you do this you run the risk of accidentally calling newer APIs, and that&apos;s what Lint now helps you detect.</div><div class="line">What about code where you are deliberately calling newer APIs from a class you know will only be loaded in the right circumstances? In that case you can &quot;mark&quot; the code as targeting a newer version of the API. Simply annotate the code with the new @TargetApiannotation:</div></pre></td></tr></table></figure>
<p>然而,当你这么做了,那么在低版本上调用新的api可能会有崩溃的风险, 这就是lint检测提示的作用之所在。<br>那么如何保证你调用的新的api的代码的相关类只会在合适的版本下才加载? 在这种情况下你可以“标注”目标的代码的所在版本的API。简单的注释代码@TargetApi</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">If the whole class is targeting newer APIs, you can place the annotation on the class instead:</div></pre></td></tr></table></figure>
<p>如果整个类都是新的api的版本，你就可以把@Target标注移除掉。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>综上，@Target的作用在于提示：使用高编译版本的代码，为了通用性兼容运行此代码的低版本平台。要求程序员做出区分对待的加载。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/09/android-v/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/09/android-v/" itemprop="url">
                  android-v
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-09T18:47:23+08:00">
                2017-02-09
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="view"><a href="#view" class="headerlink" title="view"></a>view</h1><h2 id="animation"><a href="#animation" class="headerlink" title="animation"></a>animation</h2><h3 id="帧动画-frame-anim"><a href="#帧动画-frame-anim" class="headerlink" title="帧动画 frame anim"></a>帧动画 frame anim</h3><p>动画类 AnimationDrawable<br>配置xml文件  animation-list<br>animation自定义 重写方法applyTransformation()改变Transformation<br>启动 setBackground()</p>
<h3 id="补间动画-tween-anim"><a href="#补间动画-tween-anim" class="headerlink" title="补间动画 tween anim"></a>补间动画 tween anim</h3><p>动画类 AlphaAnimation , RotateAnimation, ScaleAnimation, TranslateAnimation<br>配置xml文件 alpha, rotate, scale, translate<br>启动 AnimationUtils.loadAnimation（context，R.anim.x）;</p>
<h4 id="alpha"><a href="#alpha" class="headerlink" title="alpha"></a>alpha</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  </div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  </div><div class="line">    android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;&gt;  </div><div class="line">    &lt;!-- fromAlpha和toAlpha是起始透明度和结束时透明度 --&gt;  </div><div class="line">    &lt;alpha  </div><div class="line">        android:fromAlpha=&quot;1.0&quot;  </div><div class="line">        android:toAlpha=&quot;0.0&quot;  </div><div class="line">        android:startOffset=&quot;500&quot;  </div><div class="line">        android:duration=&quot;500&quot;/&gt;  </div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure>
<h4 id="rotate"><a href="#rotate" class="headerlink" title="rotate"></a>rotate</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  </div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  </div><div class="line">    android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;&gt;  </div><div class="line">    &lt;!--  </div><div class="line">        fromDegrees:开始的角度  </div><div class="line">        toDegrees：结束的角度，+表示是正的  </div><div class="line">        当角度为负数——表示逆时针旋转  </div><div class="line">        当角度为正数——表示顺时针旋转  </div><div class="line">        pivotX：用于设置旋转时的x轴坐标  </div><div class="line">        例  </div><div class="line">           1)当值为&quot;50&quot;，表示使用绝对位置定位  </div><div class="line">           2)当值为&quot;50%&quot;，表示使用相对于控件本身定位  </div><div class="line">           3)当值为&quot;50%p&quot;，表示使用相对于控件的父控件定位  </div><div class="line">        pivotY：用于设置旋转时的y轴坐标  </div><div class="line">      --&gt;  </div><div class="line">    &lt;rotate  </div><div class="line">        android:fromDegrees=&quot;0&quot;  </div><div class="line">        android:toDegrees=&quot;+360&quot;  </div><div class="line">        android:pivotX=&quot;50%&quot;  </div><div class="line">        android:pivotY=&quot;50%&quot;  </div><div class="line">        android:duration=&quot;1000&quot;/&gt;  </div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure>
<h4 id="scale"><a href="#scale" class="headerlink" title="scale"></a>scale</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  </div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  </div><div class="line">    android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;&gt;  </div><div class="line">   &lt;!--  </div><div class="line">       起始x轴坐标  </div><div class="line">           止x轴坐标  </div><div class="line">           始y轴坐标  </div><div class="line">           止y轴坐标  </div><div class="line">           轴的坐标  </div><div class="line">           轴的坐标  </div><div class="line">     --&gt;  </div><div class="line">   &lt;scale  </div><div class="line">       android:fromXScale=&quot;1.0&quot;  </div><div class="line">       android:toXScale=&quot;0.0&quot;  </div><div class="line">       android:fromYScale=&quot;1.0&quot;  </div><div class="line">       android:toYScale=&quot;0.0&quot;  </div><div class="line">       android:pivotX=&quot;50%&quot;  </div><div class="line">       android:pivotY=&quot;50%&quot;  </div><div class="line">       android:duration=&quot;1000&quot;/&gt;  </div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure>
<h4 id="translate"><a href="#translate" class="headerlink" title="translate"></a>translate</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  </div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  </div><div class="line">    android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;&gt;  </div><div class="line">    &lt;!--  </div><div class="line">           始x轴坐标  </div><div class="line">           止x轴坐标  </div><div class="line">           始y轴坐标  </div><div class="line">           止y轴坐标  </div><div class="line">      --&gt;  </div><div class="line">    &lt;translate  </div><div class="line">        android:fromXDelta=&quot;0%&quot;  </div><div class="line">        android:toXDelta=&quot;100%&quot;  </div><div class="line">        android:fromYDelta=&quot;0%&quot;  </div><div class="line">        android:toYDelta=&quot;100%&quot;  </div><div class="line">        android:duration=&quot;2000&quot;/&gt;  </div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure>
<h3 id="属性动画-property-anim"><a href="#属性动画-property-anim" class="headerlink" title="属性动画 property anim"></a>属性动画 property anim</h3><p>动画类 valueAnimator，objectAnimator<br>配置xml文件 alpha, rotate, scale, translate<br>启动 AnimatorInflater.loadAnimator(context, R.anim.x);</p>
<h4 id="valueAnimator"><a href="#valueAnimator" class="headerlink" title="valueAnimator"></a>valueAnimator</h4><p>addupdateListener() {  属性改变 }  </p>
<h4 id="objectAnimator"><a href="#objectAnimator" class="headerlink" title="objectAnimator"></a>objectAnimator</h4><p>属性 xxx<br>setX() , getX()<br>_offx 实例化</p>
<h4 id="offint-offfloat-offobject-offproperty-propertyvalueHolder-setCurrentPlayTime-long-playTime"><a href="#offint-offfloat-offobject-offproperty-propertyvalueHolder-setCurrentPlayTime-long-playTime" class="headerlink" title="offint , offfloat, offobject, offproperty , propertyvalueHolder, setCurrentPlayTime(long playTime)"></a>offint , offfloat, offobject, offproperty , propertyvalueHolder, setCurrentPlayTime(long playTime)</h4><h3 id="interpolator"><a href="#interpolator" class="headerlink" title="interpolator"></a>interpolator</h3><p>差值器，控制动画的变化频率 （ ～0  —-  ～1）相当于加速度 a 。<br>根据系统 SystemClock.uptimeMillis()（每次调用都获取）<br>1 计算出在(0 ~ duration ) 哪个时间点<br>2 再计算出normalizedTime （0 ～ 1）百分比<br>3 input 为 normalizedTime（0～ 1）<br>4 input 为 delta time ／ duration (0 ~ 1)<br>5 getInterpolation(float input)。<br>帧动画 补间动画 android.view.animation.Interpolator在view包下<br>属性动画 android.animation.TimeInterpolator 在animation包下<br>4.0 之后 Interpolator 继承自TimeInterpolator</p>
<h3 id="Transformation"><a href="#Transformation" class="headerlink" title="Transformation"></a>Transformation</h3><p>animation中通过applyTransformation() 来改变transformation 来作动画</p>
<h3 id="帧数"><a href="#帧数" class="headerlink" title="帧数"></a>帧数</h3><p>游戏一般到60 帧才流畅。 animator 睡眠时间是10ms 即100帧每秒。这个帧数可以调节静态方法ValueAnimator.setFrameDelay(long frameDelay)。</p>
<h3 id="TypeEvaluator"><a href="#TypeEvaluator" class="headerlink" title="TypeEvaluator"></a>TypeEvaluator</h3><p>控制做动画的view的位置。<br>根据Interpolator 计算出的fraction 和初始 、结束值来计算view 的属性值。<br>默认是 IntEvaluator 和 FloatEvaluator</p>
<h2 id="view-重绘的时机"><a href="#view-重绘的时机" class="headerlink" title="view 重绘的时机"></a>view 重绘的时机</h2><h3 id="主动重绘"><a href="#主动重绘" class="headerlink" title="主动重绘"></a>主动重绘</h3><p>invalidate()；<br>postinvalidate()；</p>
<h3 id="被动重绘"><a href="#被动重绘" class="headerlink" title="被动重绘"></a>被动重绘</h3><p>被动重绘的原则: view变化就会重绘</p>
<h4 id="view状态变化"><a href="#view状态变化" class="headerlink" title="view状态变化"></a>view状态变化</h4><p>focus<br>enable<br>selected<br>press<br>visiable</p>
<h4 id="view结构变化"><a href="#view结构变化" class="headerlink" title="view结构变化"></a>view结构变化</h4><p>增减 子view<br>宽高大小变化</p>
<h2 id="view绘制过程"><a href="#view绘制过程" class="headerlink" title="view绘制过程"></a>view绘制过程</h2><p>viewroot 发异步消息, 由Decorview开始</p>
<h3 id="1-measure-确定大小"><a href="#1-measure-确定大小" class="headerlink" title="1.measure 确定大小"></a>1.measure 确定大小</h3><p>onmeasure（）可以改变measure大小<br>setMeasureDimension（）设置大小</p>
<h3 id="2-layout-确定位置"><a href="#2-layout-确定位置" class="headerlink" title="2.layout 确定位置"></a>2.layout 确定位置</h3><p>onlayout（）可以改变view位置<br>setFrame（）设置（t，l，r，b）值</p>
<h3 id="3-draw-绘制"><a href="#3-draw-绘制" class="headerlink" title="3.draw 绘制"></a>3.draw 绘制</h3><ul>
<li>画背景</li>
<li>ondraw（）绘制视图本身</li>
<li>dispatchDraw（）绘制子视图</li>
<li>ondrawScrollBar（）绘滚动条<h3 id="invalidated调用时机"><a href="#invalidated调用时机" class="headerlink" title="invalidated调用时机"></a>invalidated调用时机</h3>重draw调用 3<h3 id="requestlayout调用时机"><a href="#requestlayout调用时机" class="headerlink" title="requestlayout调用时机"></a>requestlayout调用时机</h3>重新measure调用 1，layout调用 2</li>
</ul>
<h2 id="View-invalidate方法研究"><a href="#View-invalidate方法研究" class="headerlink" title="View invalidate方法研究"></a>View invalidate方法研究</h2><p>Invalidate 英文废弃，无效的意思。不知道写api的人为什么不用redraw之类的更直接的词语而用这个词语。<br>大家都知道，view 调用 Invalidate 方法会导致重绘。<br>那么具体的情况是什么呢？<br>我写了一个demo去研究这个方法的作用。<a href="http://download.csdn.net/detail/javalive09/6867681" target="_blank" rel="external">下载</a><br>在VISIBLE的情况下：</p>
<h3 id="一个非容器类的view-调用Invalidate"><a href="#一个非容器类的view-调用Invalidate" class="headerlink" title="一个非容器类的view 调用Invalidate():"></a>一个非容器类的view 调用Invalidate():</h3><p>会调用 此view的onDraw() ,重绘它自己。</p>
<h3 id="一个容器类的view调用Invalidate"><a href="#一个容器类的view调用Invalidate" class="headerlink" title="一个容器类的view调用Invalidate():"></a>一个容器类的view调用Invalidate():</h3><p>如果这个容器有背景，会调用 此view的onDraw() ,重绘它自己。<br>如果这个容器没有背景，不会调用 此view的onDraw() ,重绘它自己。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>不是调用Invalidate()就一定会导致重绘。</p>
<h2 id="addView-源码调用顺序的迷惑"><a href="#addView-源码调用顺序的迷惑" class="headerlink" title="addView 源码调用顺序的迷惑"></a>addView 源码调用顺序的迷惑</h2><p>addView 源码中方法调用顺序的迷惑<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public void addView(View child,int index, LayoutParams params) &#123;  </div><div class="line">        if (DBG) &#123;  </div><div class="line">            System.out.println(this +&quot; addView&quot;);  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        // addViewInner() will call child.requestLayout() when setting the new LayoutParams  </div><div class="line">        // therefore, we call requestLayout() on ourselves before, so that the child&apos;s request  </div><div class="line">        // will be blocked at our level  </div><div class="line">        requestLayout();  </div><div class="line">        invalidate(true);  </div><div class="line">        addViewInner(child, index, params, false);  </div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>为什么在addViewInner();  前要使用requestLayout();  addViewInner里面会调用requestLayout();  这样逻辑上是不是重复了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public void requestLayout() &#123;  </div><div class="line">    mPrivateFlags |= FORCE_LAYOUT;  </div><div class="line">    mPrivateFlags |= INVALIDATED;  </div><div class="line">  </div><div class="line">    if (mLayoutParams != null) &#123;  </div><div class="line">        mLayoutParams.onResolveLayoutDirection(getResolvedLayoutDirection());  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    if (mParent != null &amp;&amp; !mParent.isLayoutRequested()) &#123;  </div><div class="line">        mParent.requestLayout();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>requestLayout();的很重要的一步操作是给mPrivateFlags赋上FORCE_LAYOUT值。<br>if (mParent != null &amp;&amp; !mParent.isLayoutRequested())  这一步逻辑是。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public boolean isLayoutRequested() &#123;  </div><div class="line">    return (mPrivateFlags &amp; FORCE_LAYOUT) == FORCE_LAYOUT;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>由于requestLayout() 是从当前view往上传递来申请重新layout布局。如果父容器的mPrivateFlags不包含FORCE_LAYOUT。执行父容器的requestLayout();<br>这里父容器mPrivateFlags包含FORCE_LAYOUT，所以不会向上传递申请重新layout布局。<br>那么 mPrivateFlags 什么时候清空FORCE_LAYOUT值呢？在view 的layout 方法最后：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">public void layout(int l, int t, int r, int b) &#123;  </div><div class="line">    int oldL = mLeft;  </div><div class="line">    int oldT = mTop;  </div><div class="line">    int oldB = mBottom;  </div><div class="line">    int oldR = mRight;  </div><div class="line">    boolean changed = setFrame(l, t, r, b);  </div><div class="line">    if (changed || (mPrivateFlags &amp; LAYOUT_REQUIRED) == LAYOUT_REQUIRED) &#123;  </div><div class="line">        onLayout(changed, l, t, r, b);  </div><div class="line">        mPrivateFlags &amp;= ~LAYOUT_REQUIRED;  </div><div class="line">  </div><div class="line">        ListenerInfo li = mListenerInfo;  </div><div class="line">        if (li != null &amp;&amp; li.mOnLayoutChangeListeners != null) &#123;  </div><div class="line">            ArrayList&lt;OnLayoutChangeListener&gt; listenersCopy =  </div><div class="line">                    (ArrayList&lt;OnLayoutChangeListener&gt;)li.mOnLayoutChangeListeners.clone();  </div><div class="line">            int numListeners = listenersCopy.size();  </div><div class="line">            for (int i = 0; i &lt; numListeners; ++i) &#123;  </div><div class="line">                listenersCopy.get(i).onLayoutChange(this, l, t, r, b, oldL, oldT, oldR, oldB);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    mPrivateFlags &amp;= ~FORCE_LAYOUT;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>mPrivateFlags &amp;= ~FORCE_LAYOUT 清空了FORCE_LAYOUT。也就是 这个view layout 之后 FORCE_LAYOUT会被清空。</p>
<p>例子代码<a href="http://download.csdn.net/detail/javalive09/6867681" target="_blank" rel="external">下载</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vg.addView(new Son(MainActivity.this));  </div><div class="line">vg.addView(new Son(MainActivity.this));  </div><div class="line">vg.addView(new Son(MainActivity.this));</div></pre></td></tr></table></figure></p>
<p>站在父容器vg 的角度看，会引发如下流程：</p>
<p>view1:</p>
<ol>
<li>requestLayout(); //发出layout消息, 触发vg 的 onMeasure(), onLayout()</li>
<li>invalidate(true); //发出重绘制消息，触发vg 的draw()</li>
<li>child.setLayoutParams(params); //会触发child的layout(),  不会向父容器方向传递触发vg的layout。<br>因为被步骤1的父容器layout 的 mPrivateFlags == FORCE_LAYOUT阻断。</li>
</ol>
<p>view2:</p>
<ol>
<li>requestLayout(); // 不会发出layout消息，不会触发vg 的 onMeasure(), onLayout()。<br>因为被步骤1的父容器layout 的 mPrivateFlags == FORCE_LAYOUT阻断。</li>
<li>invalidate(true); //不会发出重绘消息，不会触发vg 的draw()。<br>因为被步骤2的 mPrivateFlags  DRAWN ／ DRAWING_CACHE_VALID／INVALIDATED阻断。</li>
<li>child.setLayoutParams(params); //会触发child的layout(),  不会向父容器方向传递触发vg的layout。<br>因为被步骤1的父容器layout 的 mPrivateFlags == FORCE_LAYOUT阻断。</li>
</ol>
<p>view3:</p>
<ol>
<li>requestLayout(); // 不会发出layout消息，不会触发vg 的 onMeasure(), onLayout()。<br>因为被步骤1的父容器layout 的 mPrivateFlags == FORCE_LAYOUT阻断。</li>
<li>invalidate(true); //不会发出重绘消息，不会触发vg 的draw()。<br>因为被步骤2的 mPrivateFlags  DRAWN ／ DRAWING_CACHE_VALID／INVALIDATED阻断。</li>
<li>child.setLayoutParams(params); //会触发child的layout(),  不会向父容器方向传递触发vg的layout。<br>被步骤1的父容器layout 的 mPrivateFlags == FORCE_LAYOUT阻断。<br>所以父类容器以及子view 的 onMeasure(), onLayout() 都只会被各调用一次。</li>
</ol>
<h2 id="view-的OnTouchListener和OnClickListener的区别"><a href="#view-的OnTouchListener和OnClickListener的区别" class="headerlink" title="view 的OnTouchListener和OnClickListener的区别"></a>view 的OnTouchListener和OnClickListener的区别</h2><p>有时候会迷惑，OnTouchListener和OnClickListener究竟有什么区别。 通过源码分析一下。</p>
<h3 id="OnTouchListener的触发逻辑"><a href="#OnTouchListener的触发逻辑" class="headerlink" title="OnTouchListener的触发逻辑"></a>OnTouchListener的触发逻辑</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public boolean dispatchTouchEvent(MotionEvent event) &#123;  </div><div class="line">    if (mInputEventConsistencyVerifier != null) &#123;  </div><div class="line">        mInputEventConsistencyVerifier.onTouchEvent(event, 0);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    if (onFilterTouchEventForSecurity(event)) &#123;  </div><div class="line">        //noinspection SimplifiableIfStatement  </div><div class="line">        ListenerInfo li = mListenerInfo;  </div><div class="line">        if (li != null &amp;&amp; li.mOnTouchListener != null &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED  </div><div class="line">                &amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123;  </div><div class="line">            return true;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        if (onTouchEvent(event)) &#123;  </div><div class="line">            return true;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    if (mInputEventConsistencyVerifier != null) &#123;  </div><div class="line">        mInputEventConsistencyVerifier.onUnhandledEvent(event, 0);  </div><div class="line">    &#125;  </div><div class="line">    return false;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>分发touch事件时 先判断mOnTouchListener.onTouch() 是否处理了 事件，如果方法返回true(处理了)，则不向下传递。<br>所以OnTouchListener 的触发时机是：手指一触摸就会触发。 action_down的时候就会触发。而且touchListener的字面意思”触碰监听”也比较贴切 。</p>
<h3 id="OnClickListener的触发逻辑"><a href="#OnClickListener的触发逻辑" class="headerlink" title="OnClickListener的触发逻辑"></a>OnClickListener的触发逻辑</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">public boolean onTouchEvent(MotionEvent event) &#123;  </div><div class="line">...  </div><div class="line">if (((viewFlags &amp; CLICKABLE) == CLICKABLE ||  </div><div class="line">                (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)) &#123;  </div><div class="line">            switch (event.getAction()) &#123;  </div><div class="line">                case MotionEvent.ACTION_UP:  </div><div class="line">                    boolean prepressed = (mPrivateFlags &amp; PREPRESSED) != 0;  </div><div class="line">                    if ((mPrivateFlags &amp; PRESSED) != 0 || prepressed) &#123;  </div><div class="line">                        // take focus if we don&apos;t have it already and we should in  </div><div class="line">                        // touch mode.  </div><div class="line">                        boolean focusTaken = false;  </div><div class="line">                        if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123;  </div><div class="line">                            focusTaken = requestFocus();  </div><div class="line">                        &#125;  </div><div class="line">  </div><div class="line">                        if (prepressed) &#123;  </div><div class="line">                            // The button is being released before we actually  </div><div class="line">                            // showed it as pressed.  Make it show the pressed  </div><div class="line">                            // state now (before scheduling the click) to ensure  </div><div class="line">                            // the user sees it.  </div><div class="line">                            setPressed(true);  </div><div class="line">                       &#125;  </div><div class="line">  </div><div class="line">                        if (!mHasPerformedLongPress) &#123;  </div><div class="line">                            // This is a tap, so remove the longpress check  </div><div class="line">                            removeLongPressCallback();  </div><div class="line">  </div><div class="line">                            // Only perform take click actions if we were in the pressed state  </div><div class="line">                            if (!focusTaken) &#123;  </div><div class="line">                                // Use a Runnable and post this rather than calling  </div><div class="line">                                // performClick directly. This lets other visual state  </div><div class="line">                                // of the view update before click actions start.  </div><div class="line">                                if (mPerformClick == null) &#123;  </div><div class="line">                                    mPerformClick = new PerformClick();  </div><div class="line">                                &#125;  </div><div class="line">                                if (!post(mPerformClick)) &#123;  </div><div class="line">                                    performClick();//触发点  </div><div class="line">                                &#125;  </div><div class="line">                            &#125;  </div><div class="line">                        &#125;  </div><div class="line">...  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面看触发点performClick()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public boolean performClick() &#123;  </div><div class="line">    sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_CLICKED);  </div><div class="line">  </div><div class="line">    ListenerInfo li = mListenerInfo;  </div><div class="line">    if (li != null &amp;&amp; li.mOnClickListener != null) &#123;  </div><div class="line">        playSoundEffect(SoundEffectConstants.CLICK);  </div><div class="line">        li.mOnClickListener.onClick(this);//触发点击事件  </div><div class="line">        return true;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    return false;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在onTouch()的事件处理的逻辑中，手指抬起 action_up 时，符合click的条件，则触发mOnClickListener的逻辑。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>OnTouchListener的触发点：action_down 手指按下时<br>OnClickListener的触发点：action_up 手指抬起时<br>OnTouchListener 处理逻辑在OnClickListener之前,  所以OnTouchListener 的onTouch（）如果返回true, 则 onTouchEvent ()中所有逻辑失效，当然OnClickListener也不会触发。</p>
<h2 id="View-touch的传递流程"><a href="#View-touch的传递流程" class="headerlink" title="View touch的传递流程"></a>View touch的传递流程</h2><p>1 - ViewRootImpl    :deliverPointerEvent()<br>2 - PhoneWindow$DecorView   :dispatchTouchEvent()<br>3 - Activity   :dispatchTouchEvent()<br>4 - PhoneWindow   :superDispatchTouchEvent()<br>5 - PhoneWindow$DecorView   :superDispatchTouchEvent()<br>6 - ViewGroup   :dispatchTouchEvent()<br>7 - ViewGroup   :dispatchTransformedTouchEvent()<br>8 - ViewGroup   :dispatchTouchEvent()</p>
<blockquote>
<p>a 如果该层view容器没有事件拦截   :onInterceptTouchEvent() == false </p>
</blockquote>
<p>9 - 延续第7 ～ 8步，遍历传递。<br>10 - View   :dispatchTouchEvent()<br>11 - View   :onTouchEvent()</p>
<blockquote>
<p>b 如果该层view容器有事件拦截   :onInterceptTouchEvent() == true  </p>
</blockquote>
<p>9 - 容器view   :onInterceptTouchEvent()<br>10 - ViewGroup   :dispatchTransformedTouchEvent()<br>11 - View   :dispatchTouchEvent()<br>12 - View   :onTouchEvent()</p>
<h3 id="dispatchTouchEvent-调用的时机"><a href="#dispatchTouchEvent-调用的时机" class="headerlink" title="dispatchTouchEvent()调用的时机"></a>dispatchTouchEvent()调用的时机</h3><p>整个view体系保持通路的情况下，每次都调用。 只要有一层view dispatchTouchEvent返回false，短路。则之后整个view体系不会再调用此方法。</p>
<h3 id="onInterceptTouchEvent-调用时机"><a href="#onInterceptTouchEvent-调用时机" class="headerlink" title="onInterceptTouchEvent()调用时机"></a>onInterceptTouchEvent()调用时机</h3><p>整个view体系保持通路的情况下，action_down时，mFirstTouchTarget != null 时。返回true拦截了mFirstTouchTarget 会置空，则之后再也不会调用此方法。</p>
<h3 id="onTouchEvent-调用时机"><a href="#onTouchEvent-调用时机" class="headerlink" title="onTouchEvent()调用时机"></a>onTouchEvent()调用时机</h3><p>整个view体系保持通路的情况下，view类总会被调用。 在viewGroup容器类中：<br>a. 如果子View onTouch()返回false没处理（mFirstTouchTarget 没赋值==null），会调用本层的onTouch();<br>b. 本层拦截了事件（mFirstTouchTarget 没赋值==null）。会调用本层的onTouch();</p>
<blockquote>
<p>注： dispatchTouchEvent 返回false，则系统下次不会再调用此方法。没有传递成功，则系统认为此事件无需再处理了。<br>什么情况下 返回false:<br>1.有targetView(有childView在点中区域), targetView dispatchTouchEvent() / onTouchEvent() 返回 false；<br>2.无targetView(无childView在点中区域，或根本无childView), 当前view  onTouchEvent() 返回 false; (是否clickable ，long_clickable)</p>
</blockquote>
<h2 id="View-draw方法传递流程"><a href="#View-draw方法传递流程" class="headerlink" title="View draw方法传递流程"></a>View draw方法传递流程</h2><p>1 - ViewRootImpl    :doTraversal()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">void doTraversal() &#123;  </div><div class="line">    if (mTraversalScheduled) &#123;  </div><div class="line">        mTraversalScheduled = false;  </div><div class="line">        mHandler.getLooper().removeSyncBarrier(mTraversalBarrier);  </div><div class="line">  </div><div class="line">        if (mProfile) &#123;  </div><div class="line">            Debug.startMethodTracing(&quot;ViewAncestor&quot;);  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        Trace.traceBegin(Trace.TRACE_TAG_VIEW, &quot;performTraversals&quot;);  </div><div class="line">        try &#123;  </div><div class="line">            performTraversals();  </div><div class="line">        &#125; finally &#123;  </div><div class="line">            Trace.traceEnd(Trace.TRACE_TAG_VIEW);  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        if (mProfile) &#123;  </div><div class="line">            Debug.stopMethodTracing();  </div><div class="line">            mProfile = false;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2 - ViewRootImpl   :performTraversals()<br>3 - ViewRootImpl   :performDraw()<br>4 - ViewRootImpl   :draw()<br>5 - PhoneWindow$DecorView   :draw()<br>6 - ViewGroup   :dispatchDraw()<br>7 - ViewGroup   :drawChild()<br>8 - View   :draw()<br>9 - 延续第 5 ～ 8步 ，遍历绘制</p>
<h2 id="如何叠加多个listview-和gridview"><a href="#如何叠加多个listview-和gridview" class="headerlink" title="如何叠加多个listview 和gridview"></a>如何叠加多个listview 和gridview</h2><p>可以重写 listView的onMeasure方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;  </div><div class="line">     int expandSpec = MeasureSpec.makeMeasureSpec(Integer.MAX_VALUE ,    </div><div class="line">                MeasureSpec.AT_MOST);    </div><div class="line">     super.onMeasure(widthMeasureSpec, expandSpec);    </div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>listView类源码中的onMeasure方法 中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (heightMode == MeasureSpec.AT_MOST) &#123;  </div><div class="line">    // TODO: after first layout we should maybe start at the first visible position, not 0  </div><div class="line">    heightSize = measureHeightOfChildren(widthMeasureSpec, 0, NO_POSITION, heightSize, -1);  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>确定heightSize;<br>在measureHeightOfChildren方法中计算heightSize的逻辑。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">if (returnedHeight &gt;= maxHeight) &#123;  </div><div class="line">                // We went over, figure out which height to return.  If returnedHeight &gt; maxHeight,  </div><div class="line">                // then the i&apos;th position did not fit completely.  </div><div class="line">                return (disallowPartialChildPosition &gt;= 0) // Disallowing is enabled (&gt; -1)  </div><div class="line">                            &amp;&amp; (i &gt; disallowPartialChildPosition) // We&apos;ve past the min pos  </div><div class="line">                            &amp;&amp; (prevHeightWithoutPartialChild &gt; 0) // We have a prev height  </div><div class="line">                            &amp;&amp; (returnedHeight != maxHeight) // i&apos;th child did not fit completely  </div><div class="line">                        ? prevHeightWithoutPartialChild  </div><div class="line">                        : maxHeight;  </div><div class="line">            &#125;</div></pre></td></tr></table></figure></p>
<p>所以只要maxHeight 足够大就会用计算出来的listView的真实高度作为高。这里用的是Integer.MAX_VALUE</p>
<blockquote>
<p>注： gridView 的onMeasure（）逻辑也类似，所以也可以用这种方法。</p>
</blockquote>
<h2 id="如何获取listview的内容高度"><a href="#如何获取listview的内容高度" class="headerlink" title="如何获取listview的内容高度"></a>如何获取listview的内容高度</h2><p>有时候需要在listview 显示之前获取内容的高度。<br>可以用 item.measure(0,0); 方式计算大小再获取。</p>
<blockquote>
<p>注：<br>item.measure(); 高度的参数是wrap_content的情况下和measure（0，0）计算的高度是一样的。<br>所以简化一下，不去配 heightMeasureSpec的值了，直接用（0，0）参数。<br>如果要配的话，可以用 MeasureSpec.makeMeasureSpec(parentSize, MeasureSpec.AT_MOST)，但是显然这样比较麻烦。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">int totalHeight = 0;  </div><div class="line">      for (int i = 0; i &lt; listAdapter.getCount(); i++) &#123;  </div><div class="line">         View listItem = listAdapter.getView(i, null, listView);  </div><div class="line">          listItem.measure(0, 0);//取wrap_content的大小的高  </div><div class="line">          totalHeight += listItem.getMeasuredHeight();  </div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<h2 id="android-scrollview-滚动时会调用onlayout么"><a href="#android-scrollview-滚动时会调用onlayout么" class="headerlink" title="android scrollview 滚动时会调用onlayout么"></a>android scrollview 滚动时会调用onlayout么</h2><p>调用onlayout 的条件是   changed == true。 setFrame 返回 true 。也就是说，必须有， top，left，right，bottom 的值的变化。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">public void layout(int l, int t, int r, int b) &#123;  </div><div class="line">    int oldL = mLeft;  </div><div class="line">    int oldT = mTop;  </div><div class="line">    int oldB = mBottom;  </div><div class="line">    int oldR = mRight;  </div><div class="line">    boolean changed = setFrame(l, t, r, b);  </div><div class="line">    if (changed || (mPrivateFlags &amp; LAYOUT_REQUIRED) == LAYOUT_REQUIRED) &#123;  </div><div class="line">        onLayout(changed, l, t, r, b);  </div><div class="line">        mPrivateFlags &amp;= ~LAYOUT_REQUIRED;  </div><div class="line">  </div><div class="line">        ListenerInfo li = mListenerInfo;  </div><div class="line">        if (li != null &amp;&amp; li.mOnLayoutChangeListeners != null) &#123;  </div><div class="line">            ArrayList&lt;OnLayoutChangeListener&gt; listenersCopy =  </div><div class="line">                    (ArrayList&lt;OnLayoutChangeListener&gt;)li.mOnLayoutChangeListeners.clone();  </div><div class="line">            int numListeners = listenersCopy.size();  </div><div class="line">            for (int i = 0; i &lt; numListeners; ++i) &#123;  </div><div class="line">                listenersCopy.get(i).onLayoutChange(this, l, t, r, b, oldL, oldT, oldR, oldB);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    mPrivateFlags &amp;= ~FORCE_LAYOUT;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">protected boolean setFrame(int left, int top, int right, int bottom) &#123;</div><div class="line">    boolean changed = false;</div><div class="line"></div><div class="line">    if (DBG) &#123;</div><div class="line">        Log.d(&quot;View&quot;, this + &quot; View.setFrame(&quot; + left + &quot;,&quot; + top + &quot;,&quot;</div><div class="line">                + right + &quot;,&quot; + bottom + &quot;)&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (mLeft != left || mRight != right || mTop != top || mBottom != bottom) &#123;</div><div class="line">        changed = true;</div><div class="line"></div><div class="line">        // Remember our drawn bit</div><div class="line">        int drawn = mPrivateFlags &amp; DRAWN;</div><div class="line"></div><div class="line">        int oldWidth = mRight - mLeft;</div><div class="line">        int oldHeight = mBottom - mTop;</div><div class="line">        int newWidth = right - left;</div><div class="line">        int newHeight = bottom - top;</div><div class="line">        boolean sizeChanged = (newWidth != oldWidth) || (newHeight != oldHeight);</div><div class="line"></div><div class="line">        // Invalidate our old position</div><div class="line">        invalidate(sizeChanged);</div><div class="line"></div><div class="line">        mLeft = left;</div><div class="line">        mTop = top;</div><div class="line">        mRight = right;</div><div class="line">        mBottom = bottom;</div><div class="line">        if (mDisplayList != null) &#123;</div><div class="line">            mDisplayList.setLeftTopRightBottom(mLeft, mTop, mRight, mBottom);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mPrivateFlags |= HAS_BOUNDS;</div><div class="line"></div><div class="line"></div><div class="line">        if (sizeChanged) &#123;</div><div class="line">            if ((mPrivateFlags &amp; PIVOT_EXPLICITLY_SET) == 0) &#123;</div><div class="line">                // A change in dimension means an auto-centered pivot point changes, too</div><div class="line">                if (mTransformationInfo != null) &#123;</div><div class="line">                    mTransformationInfo.mMatrixDirty = true;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            onSizeChanged(newWidth, newHeight, oldWidth, oldHeight);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if ((mViewFlags &amp; VISIBILITY_MASK) == VISIBLE) &#123;</div><div class="line">            // If we are visible, force the DRAWN bit to on so that</div><div class="line">            // this invalidate will go through (at least to our parent).</div><div class="line">            // This is because someone may have invalidated this view</div><div class="line">            // before this call to setFrame came in, thereby clearing</div><div class="line">            // the DRAWN bit.</div><div class="line">            mPrivateFlags |= DRAWN;</div><div class="line">            invalidate(sizeChanged);</div><div class="line">            // parent display list may need to be recreated based on a change in the bounds</div><div class="line">            // of any child</div><div class="line">            invalidateParentCaches();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // Reset drawn bit to original value (invalidate turns it off)</div><div class="line">        mPrivateFlags |= drawn;</div><div class="line"></div><div class="line">        mBackgroundSizeChanged = true;</div><div class="line">    &#125;</div><div class="line">    return changed;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而scrollview 滚动时，调用的scrollTo 方法 只改变了scrollX, scrollY 的值。然后重绘，所以不会调用onlayout方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public void scrollTo(int x, int y) &#123;  </div><div class="line">    if (mScrollX != x || mScrollY != y) &#123;  </div><div class="line">        int oldX = mScrollX;  </div><div class="line">        int oldY = mScrollY;  </div><div class="line">        mScrollX = x;  </div><div class="line">        mScrollY = y;  </div><div class="line">        invalidateParentCaches();  </div><div class="line">        onScrollChanged(mScrollX, mScrollY, oldX, oldY);  </div><div class="line">        if (!awakenScrollBars()) &#123;  </div><div class="line">            postInvalidateOnAnimation();  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="View-中的-onAttachedToWindow-onDetachedFromWindow-的作用是什么？"><a href="#View-中的-onAttachedToWindow-onDetachedFromWindow-的作用是什么？" class="headerlink" title="View 中的 onAttachedToWindow onDetachedFromWindow 的作用是什么？"></a>View 中的 onAttachedToWindow onDetachedFromWindow 的作用是什么？</h2><p>这两个方法是view对自己的被add ， 被remove 的监视。<br>onAttachedToWindow 是view 本身的回调，用于初始化一些东西相当于onstart 。当view 被添加到window中，被绘制之前的回调。如addview（this view）；<br>onDetachedFromWindow 是view 本身的回调，用于销毁一些东西onstop，当view被从window中删除时的回调。如 removeview（this view）；</p>
<h3 id="调用流程"><a href="#调用流程" class="headerlink" title="调用流程"></a>调用流程</h3><p>onAttachedToWindow():<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">viewGroup       addview（）</div><div class="line">viewGroup       addViewInner（）</div><div class="line">view            dispatchAttachedToWindow（）</div><div class="line">onAttachedToWindow（）</div></pre></td></tr></table></figure></p>
<p>onDetachedFromWindow():<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">viewGroup     removeView（）</div><div class="line">viewGroup     removeViewInternal（）</div><div class="line">view          dispatchDetachedFromWindow（）</div><div class="line">onDetachedFromWindow（）</div></pre></td></tr></table></figure></p>
<h2 id="如何在xml中引用内部类？"><a href="#如何在xml中引用内部类？" class="headerlink" title="如何在xml中引用内部类？"></a>如何在xml中引用内部类？</h2><h3 id="ViewB继承自View"><a href="#ViewB继承自View" class="headerlink" title="ViewB继承自View"></a>ViewB继承自View</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;View    </div><div class="line">        class=&quot;com.example.ClassA$ViewB&quot;    </div><div class="line">        android:layout_width=&quot;match_parent&quot;    </div><div class="line">        android:layout_height=&quot;match_parent&quot; /&gt;</div></pre></td></tr></table></figure>
<h3 id="ViewB继承自ViewGroup"><a href="#ViewB继承自ViewGroup" class="headerlink" title="ViewB继承自ViewGroup"></a>ViewB继承自ViewGroup</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;ViewGroup    </div><div class="line">    class=&quot;com.example.ClassA$ViewB&quot;    </div><div class="line">    android:layout_width=&quot;match_parent&quot;    </div><div class="line">    android:layout_height=&quot;match_parent&quot; &gt;    </div><div class="line">&lt;!-- ViewGroup内部的一些控件，比如button之类的 --&gt;    </div><div class="line">&lt;/ViewGroup&gt;</div></pre></td></tr></table></figure>
<h2 id="translateAnimation-setFillxxx-作用是什么？"><a href="#translateAnimation-setFillxxx-作用是什么？" class="headerlink" title="translateAnimation.setFillxxx()作用是什么？"></a>translateAnimation.setFillxxx()作用是什么？</h2><p>after,before 是用于设置动画结束之后画面停留的是哪帧。</p>
<h3 id="translateAnimation-setFillAfter-true"><a href="#translateAnimation-setFillAfter-true" class="headerlink" title="translateAnimation.setFillAfter(true);"></a>translateAnimation.setFillAfter(true);</h3><p>动画结束后停留在最后一帧（动画结束后画面不变）。</p>
<h3 id="translateAnimation-setFillBefore-true"><a href="#translateAnimation-setFillBefore-true" class="headerlink" title="translateAnimation.setFillBefore(true);"></a>translateAnimation.setFillBefore(true);</h3><p>动画结束后停留在第一帧（位置画面停留在动画开始位置）。</p>
<h2 id="自定义菜单时点击Menu后，自定义菜单显示，但是activity窗口没获得焦点。为什么？"><a href="#自定义菜单时点击Menu后，自定义菜单显示，但是activity窗口没获得焦点。为什么？" class="headerlink" title="自定义菜单时点击Menu后，自定义菜单显示，但是activity窗口没获得焦点。为什么？"></a>自定义菜单时点击Menu后，自定义菜单显示，但是activity窗口没获得焦点。为什么？</h2><p>自定义菜单时。一定要重写这个方法，并返回false；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public boolean onCreateOptionsMenu(Menu menu) &#123;  </div><div class="line">    return false;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="获取View的坐标"><a href="#获取View的坐标" class="headerlink" title="获取View的坐标"></a>获取View的坐标</h2><h3 id="获取在所在父View中的坐标"><a href="#获取在所在父View中的坐标" class="headerlink" title="获取在所在父View中的坐标"></a>获取在所在父View中的坐标</h3><p>getLeft() , getTop(), getBottom(), getRight()</p>
<h3 id="获取在整个屏幕中的坐标"><a href="#获取在整个屏幕中的坐标" class="headerlink" title="获取在整个屏幕中的坐标"></a>获取在整个屏幕中的坐标</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int[] location = new int[2];</div><div class="line">View.getLocationOnScreen(location);</div><div class="line">int x = location[0];</div><div class="line">int y = location[1];</div></pre></td></tr></table></figure>
<h3 id="获取在所在Activity的window中的坐标"><a href="#获取在所在Activity的window中的坐标" class="headerlink" title="获取在所在Activity的window中的坐标"></a>获取在所在Activity的window中的坐标</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int[] location = new int[2];</div><div class="line">View.getLocationInWindow(location);</div><div class="line">int x = location[0];</div><div class="line">int y = location[1];</div></pre></td></tr></table></figure>
<h3 id="getLocalVisibleRect"><a href="#getLocalVisibleRect" class="headerlink" title="getLocalVisibleRect"></a>getLocalVisibleRect</h3><p>获取视图本身可见的坐标区域，坐标以自己的左上角为原点（0，0）</p>
<h3 id="getGlobalVisibleRect"><a href="#getGlobalVisibleRect" class="headerlink" title="getGlobalVisibleRect"></a>getGlobalVisibleRect</h3><p>获取视图在屏幕坐标中的可视区域</p>
<h2 id="canvas的画文字方法参数的意义？"><a href="#canvas的画文字方法参数的意义？" class="headerlink" title="canvas的画文字方法参数的意义？"></a>canvas的画文字方法参数的意义？</h2><p>canvas.drawText(String text, float x, float y, Paint paint)<br>y 参数的意义是文字的底部的坐标。</p>
<h2 id="像素的结构"><a href="#像素的结构" class="headerlink" title="像素的结构"></a>像素的结构</h2><p>颜色（一个像素用一个int表示，32位真彩色）<br><img src="/uploads/pixel.jpg" alt=""><br>alpha通道：透明度，0~255 共256级透明度<br>一张图片所占内存 = wide <em> hight </em> 4 byte</p>
<h2 id="canvas如何画出缩放的bitmap"><a href="#canvas如何画出缩放的bitmap" class="headerlink" title="canvas如何画出缩放的bitmap"></a>canvas如何画出缩放的bitmap</h2><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public void drawBitmap(Bitmap bitmap, Rect src, Rect dst, Paint paint) &#123;  </div><div class="line">    if (dst == null) &#123;  </div><div class="line">        throw new NullPointerException();  </div><div class="line">    &#125;  </div><div class="line">    throwIfRecycled(bitmap);  </div><div class="line">    native_drawBitmap(mNativeCanvas, bitmap.ni(), src, dst,  </div><div class="line">                      paint != null ? paint.mNativePaint : 0,  </div><div class="line">                      mScreenDensity, bitmap.mDensity);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Rect src: 是对图片进行裁截，若是null则显示整个图片<br>Rect dst：是图片在Canvas画布中显示的区域，大于src则把src的裁截区放大，小于src则把src的裁截区缩小。</p>
<h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 定义矩阵对象  </div><div class="line">Matrix matrix=new Matrix(); </div><div class="line">// 缩放原图  </div><div class="line">matrix.postScale(0.5f, 0.5f); </div><div class="line">Bitmap dstbmp=Bitmap.createBitmap(bmp,0,0,bmp.getWidth(),bmp.getHeight(),matrix,true);</div></pre></td></tr></table></figure>
<h2 id="View自定义长按菜单实现"><a href="#View自定义长按菜单实现" class="headerlink" title="View自定义长按菜单实现"></a>View自定义长按菜单实现</h2><h3 id="触发流程"><a href="#触发流程" class="headerlink" title="触发流程"></a>触发流程</h3><p>响应view：ontouch() –&gt; performLongClick() –&gt; showContextMenu()<br>调用根容器：–&gt; getparent().showContextMenuForChild（this）会一层层将响应长按的view传递至父容器。</p>
<h3 id="响应逻辑"><a href="#响应逻辑" class="headerlink" title="响应逻辑"></a>响应逻辑</h3><p>在根容器中重写 showContextMenuForChild（View originalView）进行处理。</p>
<ol>
<li>originalView.onCreateContextMenu() 装填内容，originalView必须提供getContextMenuInfo()方法</li>
<li>showmenu()</li>
</ol>
<h2 id="计算android-view的FPS"><a href="#计算android-view的FPS" class="headerlink" title="计算android view的FPS"></a>计算android view的FPS</h2><p>FPS : frame per second 刷新率 ，每秒绘制的帧数。</p>
<h3 id="如何计算："><a href="#如何计算：" class="headerlink" title="如何计算："></a>如何计算：</h3><p>在onDraw() 方法中进行逻辑计算<br>每调用一次onDraw() 方法，则frame 加 1；<br>因为绘制每帧的时间不同，所以<br>当时间刚好大于1秒的时候，进行计算。<br>如绘制了60帧，刚好用了1.2秒<br>则 fps ＝ 60 / 1.2；<br>fps ＝ 50 帧/秒；</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line"></div><div class="line">protected void onDraw(Canvas canvas) &#123;</div><div class="line"></div><div class="line">    super.onDraw(canvas);</div><div class="line"></div><div class="line">//耗时的绘制</div><div class="line"></div><div class="line">draw。。。。。。。。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    // fps counter: count how many frames we draw and once a second calculate the</div><div class="line"></div><div class="line">    // frames per second</div><div class="line"></div><div class="line">    ++frames;</div><div class="line"></div><div class="line">    long nowTime = System.currentTimeMillis();</div><div class="line"></div><div class="line">    long deltaTime = nowTime - startTime;</div><div class="line"></div><div class="line">    if (deltaTime &gt; 1000) &#123;</div><div class="line"></div><div class="line">        float secs = (float) deltaTime / 1000f;</div><div class="line"></div><div class="line">        fps = (float) frames / secs;</div><div class="line"></div><div class="line">        fpsString = &quot;fps: &quot; + fps;</div><div class="line"></div><div class="line">        startTime = nowTime;</div><div class="line"></div><div class="line">        frames = 0;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">   canvas.drawText(fpsString, getWidth() - 200, getHeight() - 80, textPaint);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="android中改变view位置的几种方法"><a href="#android中改变view位置的几种方法" class="headerlink" title="android中改变view位置的几种方法"></a>android中改变view位置的几种方法</h2><h3 id="调用-layout方法"><a href="#调用-layout方法" class="headerlink" title="调用 layout方法"></a>调用 layout方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public void layout(int l, int t, int r, int b) &#123;</div><div class="line">    int oldL = mLeft;</div><div class="line">    int oldT = mTop;</div><div class="line">    int oldB = mBottom;</div><div class="line">    int oldR = mRight;</div><div class="line">    boolean changed = setFrame(l, t, r, b);</div><div class="line">    if (changed || (mPrivateFlags &amp; LAYOUT_REQUIRED) == LAYOUT_REQUIRED) &#123;</div><div class="line">        if (ViewDebug.TRACE_HIERARCHY) &#123;</div><div class="line">            ViewDebug.trace(this, ViewDebug.HierarchyTraceType.ON_LAYOUT);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        onLayout(changed, l, t, r, b);</div><div class="line">        mPrivateFlags &amp;= ~LAYOUT_REQUIRED;</div><div class="line"></div><div class="line">        if (mOnLayoutChangeListeners != null) &#123;</div><div class="line">            ArrayList&lt;OnLayoutChangeListener&gt; listenersCopy =</div><div class="line">                    (ArrayList&lt;OnLayoutChangeListener&gt;) mOnLayoutChangeListeners.clone();</div><div class="line">            int numListeners = listenersCopy.size();</div><div class="line">            for (int i = 0; i &lt; numListeners; ++i) &#123;</div><div class="line">                listenersCopy.get(i).onLayoutChange(this, l, t, r, b, oldL, oldT, oldR, oldB);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    mPrivateFlags &amp;= ~FORCE_LAYOUT;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="设置MarginLayoutParams，-然后调用setLayoutParams"><a href="#设置MarginLayoutParams，-然后调用setLayoutParams" class="headerlink" title="设置MarginLayoutParams， 然后调用setLayoutParams()"></a>设置MarginLayoutParams， 然后调用setLayoutParams()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public void setLayoutParams(ViewGroup.LayoutParams params) &#123;</div><div class="line">    if (params == null) &#123;</div><div class="line">        throw new NullPointerException(&quot;Layout parameters cannot be null&quot;);</div><div class="line">    &#125;</div><div class="line">    mLayoutParams = params;</div><div class="line">    requestLayout();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="外容器scrollTo-方法。改变view窗体位置。会改变所有的子View位置"><a href="#外容器scrollTo-方法。改变view窗体位置。会改变所有的子View位置" class="headerlink" title="外容器scrollTo 方法。改变view窗体位置。会改变所有的子View位置"></a>外容器scrollTo 方法。改变view窗体位置。会改变所有的子View位置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public void scrollTo(int x, int y) &#123;  </div><div class="line">    if (mScrollX != x || mScrollY != y) &#123;  </div><div class="line">        int oldX = mScrollX;  </div><div class="line">        int oldY = mScrollY;  </div><div class="line">        mScrollX = x;  </div><div class="line">        mScrollY = y;  </div><div class="line">        invalidateParentCaches();  </div><div class="line">        onScrollChanged(mScrollX, mScrollY, oldX, oldY);  </div><div class="line">        if (!awakenScrollBars()) &#123;  </div><div class="line">            invalidate(true);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="view-的scroll系列方法的理解"><a href="#view-的scroll系列方法的理解" class="headerlink" title="view 的scroll系列方法的理解"></a>view 的scroll系列方法的理解</h2><h3 id="scrollTo"><a href="#scrollTo" class="headerlink" title="scrollTo():"></a>scrollTo():</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public void scrollTo(int x, int y) &#123;  </div><div class="line">    if (mScrollX != x || mScrollY != y) &#123;  </div><div class="line">        int oldX = mScrollX;  </div><div class="line">        int oldY = mScrollY;  </div><div class="line">        mScrollX = x;  </div><div class="line">        mScrollY = y;  </div><div class="line">        invalidateParentCaches();  </div><div class="line">        onScrollChanged(mScrollX, mScrollY, oldX, oldY);  </div><div class="line">        if (!awakenScrollBars()) &#123;  </div><div class="line">            invalidate(true);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="scrollBy"><a href="#scrollBy" class="headerlink" title="scrollBy()"></a>scrollBy()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public void scrollBy(int x, int y) &#123;  </div><div class="line">    scrollTo(mScrollX + x, mScrollY + y);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="setScrollX"><a href="#setScrollX" class="headerlink" title="setScrollX"></a>setScrollX</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public void setScrollX(int value) &#123;  </div><div class="line">    scrollTo(value, mScrollY);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="setScrollY"><a href="#setScrollY" class="headerlink" title="setScrollY"></a>setScrollY</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public void setScrollY(int value) &#123;  </div><div class="line">    scrollTo(mScrollX, value);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>scroll方法针对的是view中的内容。<br>如view.scrollTo(50,0); 表示的是针对内容的（0，0）坐标view滚动了50个像素。<br>展现的是，内容向左边移动了50个像素。<br><img src="/uploads/scroll.jpg" alt=""></p>
<h2 id="LayoutInflater-的inflate-int-resource-ViewGroup-root-boolean-attachToRoot-方法研究"><a href="#LayoutInflater-的inflate-int-resource-ViewGroup-root-boolean-attachToRoot-方法研究" class="headerlink" title="LayoutInflater 的inflate(int resource, ViewGroup root, boolean attachToRoot)方法研究"></a>LayoutInflater 的inflate(int resource, ViewGroup root, boolean attachToRoot)方法研究</h2><h3 id="情况一：-root-null-attachToRoot-false"><a href="#情况一：-root-null-attachToRoot-false" class="headerlink" title="情况一： root =null,  attachToRoot = false;"></a>情况一： root =null,  attachToRoot = false;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">View temp = createViewFromTag(root, name, attrs);  </div><div class="line">  </div><div class="line">// Inflate all children under temp  </div><div class="line">rInflate(parser, temp, attrs, true);  </div><div class="line">  </div><div class="line">return temp;</div></pre></td></tr></table></figure>
<h3 id="情况二：root-null-attachToRoot-false"><a href="#情况二：root-null-attachToRoot-false" class="headerlink" title="情况二：root != null, attachToRoot = false;"></a>情况二：root != null, attachToRoot = false;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">View temp = createViewFromTag(root, name, attrs);  </div><div class="line">  </div><div class="line">ViewGroup.LayoutParams params = root.generateLayoutParams(attrs);  </div><div class="line">temp.setLayoutParams(params);  </div><div class="line">  </div><div class="line">// Inflate all children under temp  </div><div class="line">rInflate(parser, temp, attrs, true);  </div><div class="line">  </div><div class="line">return temp;</div></pre></td></tr></table></figure>
<h3 id="情况三：root-null-attachToRoot-true"><a href="#情况三：root-null-attachToRoot-true" class="headerlink" title="情况三：root != null, attachToRoot = true;"></a>情况三：root != null, attachToRoot = true;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">View temp = createViewFromTag(root, name, attrs);  </div><div class="line">  </div><div class="line">ViewGroup.LayoutParams params = root.generateLayoutParams(attrs);  </div><div class="line">temp.setLayoutParams(params);  </div><div class="line">  </div><div class="line">// Inflate all children under temp  </div><div class="line">rInflate(parser, temp, attrs, true);  </div><div class="line">  </div><div class="line">root.addView(temp, params);  </div><div class="line">  </div><div class="line">return root;</div></pre></td></tr></table></figure>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><h4 id="root为空时"><a href="#root为空时" class="headerlink" title="root为空时"></a>root为空时</h4><p>返回temp。</p>
<h4 id="root-不为空时"><a href="#root-不为空时" class="headerlink" title="root 不为空时"></a>root 不为空时</h4><p>attachToRoot = true 。返回root；<br>attachToRoot = false。设置temp  layoutParams 。返回temp。</p>
<h2 id="ViewPager-SimpleOnPageChangeListener中回调函数的调用场景"><a href="#ViewPager-SimpleOnPageChangeListener中回调函数的调用场景" class="headerlink" title="ViewPager SimpleOnPageChangeListener中回调函数的调用场景"></a>ViewPager SimpleOnPageChangeListener中回调函数的调用场景</h2><p>Listener 的源码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">240     public static class SimpleOnPageChangeListener implements OnPageChangeListener &#123;  </div><div class="line">241         @Override  </div><div class="line">242         public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) &#123;  </div><div class="line">243             // This space for rent  </div><div class="line">244         &#125;  </div><div class="line">245   </div><div class="line">246         @Override  </div><div class="line">247         public void onPageSelected(int position) &#123;  </div><div class="line">248             // This space for rent  </div><div class="line">249         &#125;  </div><div class="line">250   </div><div class="line">251         @Override  </div><div class="line">252         public void onPageScrollStateChanged(int state) &#123;  </div><div class="line">253             // This space for rent  </div><div class="line">254         &#125;  </div><div class="line">255     &#125;</div></pre></td></tr></table></figure></p>
<h3 id="1-onPageScrolled-int-position-float-positionOffset-int-positionOffsetPixels-："><a href="#1-onPageScrolled-int-position-float-positionOffset-int-positionOffsetPixels-：" class="headerlink" title="1.onPageScrolled(int position, float positionOffset, int positionOffsetPixels)："></a>1.onPageScrolled(int position, float positionOffset, int positionOffsetPixels)：</h3><p>position:当前的位置<br>positionoffset:当前滚动比例（左－右／0-1）（右－左／1-0）<br>positionOffsetPixels：当前实际滚动的像素（左－右／0-页宽） （右－左／页宽－0）</p>
<h4 id="被调用的场景"><a href="#被调用的场景" class="headerlink" title="被调用的场景:"></a>被调用的场景:</h4><p>ViewPager滚动时总被回调，这个函数在操作ViewPager时被回调很多次。<br>1.手指拖动 action_move 。n次<br>2.惯性还原 computeScroll()。n次</p>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景:"></a>使用场景:</h4><p>做view的动画效果时可以用这个回调函数。</p>
<h3 id="2-onPageSelected-int-position"><a href="#2-onPageSelected-int-position" class="headerlink" title="2.onPageSelected(int position)"></a>2.onPageSelected(int position)</h3><h4 id="被调用的场景："><a href="#被调用的场景：" class="headerlink" title="被调用的场景："></a>被调用的场景：</h4><p>ViewPager确定页面是哪一页时。1次</p>
<ol>
<li>手指拖动后抬起 action_up 。1次</li>
<li>或者手指滑动超出屏幕时 action_cancel。1次<h4 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h4>页面切换后改变对应的tab的状态可以用这个回调函数。<h3 id="3-onPageScrollStateChanged-int-state"><a href="#3-onPageScrollStateChanged-int-state" class="headerlink" title="3.onPageScrollStateChanged(int state):"></a>3.onPageScrollStateChanged(int state):</h3><h4 id="被调用的场景：-1"><a href="#被调用的场景：-1" class="headerlink" title="被调用的场景："></a>被调用的场景：</h4>ViewPager状态切换时被调用。这个函数在操作ViewPager时被回调3次。<br>1.开始滚动 dragging拖动状态。1次<br>2.惯性滚动 settling还原状态。1次<br>3.滚动结束 idle空闲状态。1次<h4 id="使用场景：-1"><a href="#使用场景：-1" class="headerlink" title="使用场景："></a>使用场景：</h4>做页面状态变化后引起的view特效时可以用这个回调函数</li>
</ol>
<h2 id="TextView-setEms-方法名字"><a href="#TextView-setEms-方法名字" class="headerlink" title="TextView setEms 方法名字"></a>TextView setEms 方法名字</h2><p>Android TextView setEms() 作用是设置textview的字符宽度。但是名字很奇怪。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/** </div><div class="line"> * Makes the TextView exactly this many ems wide </div><div class="line"> * </div><div class="line"> * @attr ref android.R.styleable#TextView_ems </div><div class="line"> */  </div><div class="line">@android.view.RemotableViewMethod  </div><div class="line">public void setEms(int ems) &#123;  </div><div class="line">    mMaxWidth = mMinWidth = ems;  </div><div class="line">    mMaxWidthMode = mMinWidthMode = EMS;  </div><div class="line">  </div><div class="line">    requestLayout();  </div><div class="line">    invalidate();  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>An em is a unit in the field of typography<br>em是一个印刷排版的单位，表示字宽的单位。 em字面意思为：equal M   （和M字符一致的宽度为一个单位）简称em。<br>ems是em的复数表达。<br><a href="http://en.wikipedia.org/wiki/Em_%28typography%29" target="_blank" rel="external">em 的具体来历？</a></p>
<h2 id="View容器-measure-流程"><a href="#View容器-measure-流程" class="headerlink" title="View容器 measure 流程"></a>View容器 measure 流程</h2><h3 id="FrameLayout-onMeasure"><a href="#FrameLayout-onMeasure" class="headerlink" title="FrameLayout onMeasure()"></a>FrameLayout onMeasure()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1.    measureChildWithMargins() ViewGroup.Java</div><div class="line">1.1   getChildMeasureSpec()     ViewGroup.java</div><div class="line">1.2   child.measure()  View.java</div><div class="line">1.2.1 chlid.onMeasure()        </div><div class="line"></div><div class="line">2.    resolveSizeAndState()     View.java</div><div class="line">3.    setMeasuredDimension()    View.java</div></pre></td></tr></table></figure>
<h3 id="LinearLayout-onMeasure"><a href="#LinearLayout-onMeasure" class="headerlink" title="LinearLayout onMeasure()"></a>LinearLayout onMeasure()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1.    measureChildWithMargins() ViewGroup.java</div><div class="line">1.1   getChildMeasureSpec()     ViewGroup.java</div><div class="line">1.2   child.measure()  View.java</div><div class="line">1.2.1 chlid.onMeasure()        </div><div class="line"></div><div class="line">2.    resolveSizeAndState()     View.java</div><div class="line">3.    setMeasuredDimension()    View.java</div></pre></td></tr></table></figure>
<h3 id="RelateveLayout-onMeasure"><a href="#RelateveLayout-onMeasure" class="headerlink" title="RelateveLayout onMeasure()"></a>RelateveLayout onMeasure()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1.    measureChild()            RelateveLayout.java</div><div class="line">1.1   getChildMeasureSpec()     RelateveLayout.java</div><div class="line">1.2   child.measure()  View.java</div><div class="line">1.2.1 chlid.onMeasure()        </div><div class="line"></div><div class="line">2.    resolveSizeAndState()    View.java</div><div class="line">3.    setMeasuredDimension()    View.java</div></pre></td></tr></table></figure>
<h3 id="AbsoluteLayout-onMeasure"><a href="#AbsoluteLayout-onMeasure" class="headerlink" title="AbsoluteLayout onMeasure()"></a>AbsoluteLayout onMeasure()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1.    measureChildren()         ViewGroup.java</div><div class="line">1.1   getChildMeasureSpec()     ViewGroup.java</div><div class="line">1.2   child.measure()  View.java</div><div class="line">1.2.1 chlid.onMeasure()        </div><div class="line"></div><div class="line">2.    resolveSizeAndState()    View.java</div><div class="line">3.    setMeasuredDimension()    View.java</div></pre></td></tr></table></figure>
<hr>
<h1 id="window"><a href="#window" class="headerlink" title="window"></a>window</h1><h2 id="animation-1"><a href="#animation-1" class="headerlink" title="animation"></a>animation</h2><h3 id="启动动画"><a href="#启动动画" class="headerlink" title="启动动画"></a>启动动画</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">startActivity(new Intent(A.this, B.class));  </div><div class="line">overridePendingTransition(inAnim, outAnim);</div></pre></td></tr></table></figure>
<h3 id="结束动画"><a href="#结束动画" class="headerlink" title="结束动画"></a>结束动画</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">finish();  </div><div class="line">activity.overridePendingTransition(inAnim, outAnim);</div></pre></td></tr></table></figure>
<h3 id="全局activity动画"><a href="#全局activity动画" class="headerlink" title="全局activity动画"></a>全局activity动画</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;style name=&quot;Theme.Test&quot; parent=&quot;@android:style/Theme.Light.NoTitleBar&quot;&gt;  </div><div class="line">    &lt;item name=&quot;android:windowAnimationStyle&quot;&gt;@style/Animation.Activity.Test&lt;/item&gt;  </div><div class="line">&lt;/style&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;style name=&quot;Animation.Activity.Test&quot; parent=&quot;@android:style/Animation.Activity&quot;&gt;  </div><div class="line">    &lt;item name=&quot;android:activityOpenEnterAnimation&quot;&gt;@anim/activity_open_enter&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:activityOpenExitAnimation&quot;&gt;@anim/activity_open_exit&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:activityCloseEnterAnimation&quot;&gt;@anim/activity_close_enter&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:activityCloseExitAnimation&quot;&gt;@anim/activity_close_exit&lt;/item&gt;  </div><div class="line">             </div><div class="line">    &lt;item name=&quot;android:taskOpenEnterAnimation&quot;&gt;@anim/activity_open_enter&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:taskOpenExitAnimation&quot;&gt;@anim/activity_open_exit&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:taskCloseEnterAnimation&quot;&gt;@anim/activity_close_enter&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:taskCloseExitAnimation&quot;&gt;@anim/activity_close_exit&lt;/item&gt;  </div><div class="line">             </div><div class="line">    &lt;item name=&quot;android:taskToFrontEnterAnimation&quot;&gt;@anim/activity_open_enter&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:taskToFrontExitAnimation&quot;&gt;@anim/activity_open_exit&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:taskToBackEnterAnimation&quot;&gt;@anim/activity_close_enter&lt;/item&gt;  </div><div class="line">    &lt;item name=&quot;android:taskToBackExitAnimation&quot;&gt;@anim/activity_close_exit&lt;/item&gt;  </div><div class="line">&lt;/style&gt;</div></pre></td></tr></table></figure>
<h2 id="不影响系统交互的悬浮窗window参数设置"><a href="#不影响系统交互的悬浮窗window参数设置" class="headerlink" title="不影响系统交互的悬浮窗window参数设置"></a>不影响系统交互的悬浮窗window参数设置</h2><p>type:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">WindowManager.LayoutParams.TYPE_TOAST</div></pre></td></tr></table></figure></p>
<p>flag：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE|</div><div class="line">        WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">if (mVolumeView == null) &#123;  </div><div class="line">    WindowManager mWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);  </div><div class="line">    View rootView = View.inflate(context, R.layout.volume_layout, null);  </div><div class="line">    mVolumeView = (VolumeView) rootView.findViewById(R.id.volume);  </div><div class="line">    WindowManager.LayoutParams layoutParams = new WindowManager.LayoutParams(  </div><div class="line">            WindowManager.LayoutParams.MATCH_PARENT,  </div><div class="line">            WindowManager.LayoutParams.MATCH_PARENT,  </div><div class="line">            WindowManager.LayoutParams.TYPE_TOAST,  </div><div class="line">            WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE|  </div><div class="line">                    WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE,  </div><div class="line">            PixelFormat.TRANSLUCENT);  </div><div class="line">    layoutParams.gravity = Gravity.TOP;  </div><div class="line">    mWindowManager.addView(rootView, layoutParams);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="如何监听window的back键"><a href="#如何监听window的back键" class="headerlink" title="如何监听window的back键"></a>如何监听window的back键</h2><p>可以重写window的根view的dispatchKeyEvent方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">WindowManager mWindowManager = (WindowManager) getContext().getSystemService(Context.WINDOW_SERVICE);  </div><div class="line">Display display = mWindowManager.getDefaultDisplay();  </div><div class="line">int width = display.getWidth();  </div><div class="line">int height = display.getHeight();  </div><div class="line">int statusBarHeight = getStatusBarHeight();  </div><div class="line">final PopupWindow pw = new PopupWindow(width, height - statusBarHeight);  </div><div class="line">  </div><div class="line">final FrameLayout container = new FrameLayout(getContext())&#123;  </div><div class="line">  </div><div class="line">    @Override  </div><div class="line">    public boolean dispatchKeyEvent(KeyEvent event) &#123;  </div><div class="line">        if(event.getAction() == KeyEvent.ACTION_UP) &#123;  </div><div class="line">            if(event.getKeyCode() == KeyEvent.KEYCODE_BACK) &#123;  </div><div class="line">                Log.addLog(this, &quot;window height =&quot; + pw.getHeight());  </div><div class="line">                removeAllViews();  </div><div class="line">                pw.dismiss();  </div><div class="line">                return true;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        return super.dispatchKeyEvent(event);  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">&#125;;  </div><div class="line">container.addView(view, params);  </div><div class="line">pw.setContentView(container);  </div><div class="line">pw.setFocusable(true);  </div><div class="line">pw.setAnimationStyle(R.style.popUpWindowAnimation);  </div><div class="line">pw.showAtLocation(this, Gravity.NO_GRAVITY, 0, statusBarHeight);</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="设备的适配"><a href="#设备的适配" class="headerlink" title="设备的适配"></a>设备的适配</h1><p><img src="/uploads/fitres.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/09/android-m/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/09/android-m/" itemprop="url">
                  android-m
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-09T18:13:20+08:00">
                2017-02-09
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><h2 id="数据库设计范式"><a href="#数据库设计范式" class="headerlink" title="数据库设计范式"></a>数据库设计范式</h2><h3 id="第一范式"><a href="#第一范式" class="headerlink" title="第一范式"></a>第一范式</h3><p>字段不可再分</p>
<h3 id="第二范式"><a href="#第二范式" class="headerlink" title="第二范式"></a>第二范式</h3><p>一个表只表示一个事物</p>
<h3 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h3><p>每一列都与主键有直接关系，不存在传递依赖。</p>
<h2 id="sqlite数据库"><a href="#sqlite数据库" class="headerlink" title="sqlite数据库"></a>sqlite数据库</h2><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1.extend SQLiteOpenHelper</div><div class="line">2. new xx()</div><div class="line">3. .getWirtableDatabase();</div></pre></td></tr></table></figure>
<h3 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h3><h4 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h4><p>CREATE TABLE 表名 (列名1 类型，列名2 类型)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create table if not exists person(persionid integer primary key autoincrement, name varchar(20));</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.execSQL(&quot;CREATE TABLE person (personid integer primary key autoincrement, name varchar(20))&quot;);</div></pre></td></tr></table></figure>
<h4 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h4><p>ALTER TABLE 表名 ADD 列名 类型 NULL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table person add phone varchar(20);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.execSQL(&quot;ALTER TABLE person ADD phone VARCHAR(12) NULL &quot;);</div></pre></td></tr></table></figure>
<h4 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h4><p>insert into 表名 （列名1，列名2 ）values （值1，值2）；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">insert into person(name,phone) values(&apos;peter&apos;,&apos;123&apos;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.execSQL(&quot;insert into person (name,phone) values (?,?)&quot;, new Object[] &#123; &quot;peter&quot;, &quot;123&quot;&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ContentValues values = new ContentValues();  </div><div class="line">values.put(&quot;name&quot;, name);  </div><div class="line">values.put(&quot;age&quot;, age);  </div><div class="line">// 如果 contentvalues为空  </div><div class="line">db.insert(&quot;person&quot;, null, values); // 组拼sql语句完成的添加的操作</div></pre></td></tr></table></figure>
<h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><p>delete from 表名 where 条件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delete from person where name = &quot;peter&quot;;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.execSQL(&quot;delete from person where name =?&quot;, new Object[] &#123; &quot;peter&quot;&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.delete(&quot;person&quot;, &quot;name=?&quot;, new String[] &#123; name &#125;);</div></pre></td></tr></table></figure>
<h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">update person set name=&apos;p&apos;,phone=&apos;456&apos; where name=&apos;peter&apos;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.execSQL(&quot;update person set name=? , phone=? where name=?&quot;, new Object[] &#123; newname, newphone, name &#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ContentValues values = new ContentValues();  </div><div class="line">values.put(&quot;name&quot;, newname);  </div><div class="line">values.put(“phone”, newphone);  </div><div class="line">db.update(&quot;person&quot;, values, &quot;name=?&quot;, new String[] &#123; name &#125;);</div></pre></td></tr></table></figure>
<h4 id="查询信息"><a href="#查询信息" class="headerlink" title="查询信息"></a>查询信息</h4><p>select 列名 from 表名 where 条件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from person where name=&quot;peter&quot;;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.rawQuery(&quot;select * from person where name=?&quot;, new String[] &#123; name &#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Cursor cursor = db.query(&quot;person&quot;, null, &quot;name=?&quot;, new String[] &#123; name &#125;, null, null, null);</div></pre></td></tr></table></figure>
<h4 id="查询个数"><a href="#查询个数" class="headerlink" title="查询个数"></a>查询个数</h4><p>select count(column) from 表名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select count(*) from person;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.rawQuery(&quot;select count(*) from person&quot;, null);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if(cursor.moveToNext()) &#123;  </div><div class="line">    int index = cursor.getColumnIndex(&quot;columnName&quot;);  </div><div class="line">    int count = cursor.getInt(index);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="清空表"><a href="#清空表" class="headerlink" title="清空表"></a>清空表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.execSQL(&quot;delete from &quot;+ TABLE_NAME);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.delete(TABLE_NAME, null, null);</div></pre></td></tr></table></figure>
<p>需要返回删除数量可以用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.delete(TABLE_NAME, &quot;1&quot;, null);</div></pre></td></tr></table></figure></p>
<h3 id="设计数据库时需要考虑的问题"><a href="#设计数据库时需要考虑的问题" class="headerlink" title="设计数据库时需要考虑的问题"></a>设计数据库时需要考虑的问题</h3><h4 id="数据库升级"><a href="#数据库升级" class="headerlink" title="数据库升级"></a>数据库升级</h4><h4 id="多线程访问"><a href="#多线程访问" class="headerlink" title="多线程访问"></a>多线程访问</h4><h4 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h4><h4 id="速度优化"><a href="#速度优化" class="headerlink" title="速度优化"></a>速度优化</h4><h3 id="getWritableDatabase-和getReadableDataBase-的区别"><a href="#getWritableDatabase-和getReadableDataBase-的区别" class="headerlink" title="getWritableDatabase()和getReadableDataBase()的区别"></a>getWritableDatabase()和getReadableDataBase()的区别</h3><p>一般情况下return相同对象。在磁盘满的情况下。getReadableDataBase() return 只读对象。getWritableDataBase()抛出异常。</p>
<h3 id="升级的逻辑"><a href="#升级的逻辑" class="headerlink" title="升级的逻辑"></a>升级的逻辑</h3><ol>
<li>数据库文件version    ==  openhelper 设置db的Version 。 开启数据库。</li>
<li>数据库文件version    !=    openhelper 设置db的Version。<br> a. == 0  oncreate()<br> b. &gt;     onDowngrade()<br> c. &lt;     onUpgrade() </li>
</ol>
<h2 id="CursorAdapter刷新机制"><a href="#CursorAdapter刷新机制" class="headerlink" title="CursorAdapter刷新机制"></a>CursorAdapter刷新机制</h2><p>今天看downloadmanager源码发现 cursorAdapter 会在数据变化的情况下没有调用notifydatasetxx() 而是自动刷新。和其他adapeter刷新方式不一样。<br>看了一下源码，发现cursoradapter内部有自动的刷新代码。如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">void init(Context context, Cursor c, int flags) &#123;  </div><div class="line">    if ((flags &amp; FLAG_AUTO_REQUERY) == FLAG_AUTO_REQUERY) &#123;  </div><div class="line">        flags |= FLAG_REGISTER_CONTENT_OBSERVER;  </div><div class="line">        mAutoRequery = true;  </div><div class="line">    &#125; else &#123;  </div><div class="line">        mAutoRequery = false;  </div><div class="line">    &#125;  </div><div class="line">    boolean cursorPresent = c != null;  </div><div class="line">    mCursor = c;  </div><div class="line">    mDataValid = cursorPresent;  </div><div class="line">    mContext = context;  </div><div class="line">    mRowIDColumn = cursorPresent ? c.getColumnIndexOrThrow(&quot;_id&quot;) : -1;  </div><div class="line">    if ((flags &amp; FLAG_REGISTER_CONTENT_OBSERVER) == FLAG_REGISTER_CONTENT_OBSERVER) &#123;  </div><div class="line">        mChangeObserver = new ChangeObserver();  </div><div class="line">        mDataSetObserver = new MyDataSetObserver();  </div><div class="line">    &#125; else &#123;  </div><div class="line">        mChangeObserver = null;  </div><div class="line">        mDataSetObserver = null;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    if (cursorPresent) &#123;  </div><div class="line">        if (mChangeObserver != null) c.registerContentObserver(mChangeObserver);  </div><div class="line">        if (mDataSetObserver != null) c.registerDataSetObserver(mDataSetObserver);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>observer代码中会进行数据更新，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">private class MyDataSetObserver extends DataSetObserver &#123;  </div><div class="line">    @Override  </div><div class="line">    public void onChanged() &#123;  </div><div class="line">        mDataValid = true;  </div><div class="line">        notifyDataSetChanged();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    @Override  </div><div class="line">    public void onInvalidated() &#123;  </div><div class="line">        mDataValid = false;  </div><div class="line">        notifyDataSetInvalidated();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="SharedPreference"><a href="#SharedPreference" class="headerlink" title="SharedPreference"></a>SharedPreference</h1><h2 id="使用方法1"><a href="#使用方法1" class="headerlink" title="使用方法1"></a>使用方法1</h2><p>Activity中getPreferences(int mode)。 xml文件名：(activity类全名去掉包名).xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public SharedPreferences getPreferences(int mode) &#123;  </div><div class="line">    return getSharedPreferences(getLocalClassName(), mode);  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public String getLocalClassName() &#123;  </div><div class="line">    final String pkg = getPackageName();  </div><div class="line">    final String cls = mComponent.getClassName();  </div><div class="line">    int packageLen = pkg.length();  </div><div class="line">    if (!cls.startsWith(pkg) || cls.length() &lt;= packageLen  </div><div class="line">            || cls.charAt(packageLen) != &apos;.&apos;) &#123;  </div><div class="line">        return cls;  </div><div class="line">    &#125;  </div><div class="line">    return cls.substring(packageLen+1);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用方法2"><a href="#使用方法2" class="headerlink" title="使用方法2"></a>使用方法2</h2><p>context中getSharedPreferences(String name, int mode)。xml文件名：name.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override  </div><div class="line">public SharedPreferences getSharedPreferences(String name, int mode) &#123;  </div><div class="line">    return mBase.getSharedPreferences(name, mode);  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="使用方法3"><a href="#使用方法3" class="headerlink" title="使用方法3"></a>使用方法3</h2><p>PreferenceManager中getDefaultSharedPreferencesName(Context context) xml文件名：包名_preferences.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public static SharedPreferences getDefaultSharedPreferences(Context context) &#123;  </div><div class="line">    return context.getSharedPreferences(getDefaultSharedPreferencesName(context),  </div><div class="line">            getDefaultSharedPreferencesMode());  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line">private static String getDefaultSharedPreferencesName(Context context) &#123;  </div><div class="line">    return context.getPackageName() + &quot;_preferences&quot;;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/09/正则表达式/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/09/正则表达式/" itemprop="url">
                  正则表达式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-09T17:27:56+08:00">
                2017-02-09
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>Regular Expression，在代码中常简写为regex、regexp或RE。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/09/正则表达式/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/09/设计模式/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/09/设计模式/" itemprop="url">
                  设计模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-09T15:15:25+08:00">
                2017-02-09
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>抽象是对象语言的最大本事，各个层次的抽象。哪里变化抽象哪里。哪里可扩展抽象哪里。抽象的好处：1．解耦、增加可扩展性 2．统一类型（变量的类型），使用方便 3．抽象更符合人得逻辑使问题简化。设计模式是被反复使用的软件代码设计经验（如何更好的使用抽象方法）的总结。是设计方法，不是编程技术。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/09/设计模式/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/09/java3/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/09/java3/" itemprop="url">
                  java3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-09T12:01:28+08:00">
                2017-02-09
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>JVM虚拟机, java多线程并发处理, 反射, 动态代理<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/09/java3/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/08/java2/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/java2/" itemprop="url">
                  java2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T21:21:28+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>多线程, IO流, 容器, 内部类, 网络<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/08/java2/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/08/java1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/java1/" itemprop="url">
                  java1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T10:13:36+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>基本类型, 面向对象, 内存回收, 异常处理<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/08/java1/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/07/在mac下使用hexo搭建github-pages博客/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/07/在mac下使用hexo搭建github-pages博客/" itemprop="url">
                  在mac下使用hexo搭建github pages博客
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-07T18:41:21+08:00">
                2017-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>搭建属于自己的独立博客.<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/07/在mac下使用hexo搭建github-pages博客/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/07/hello-world/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="peter">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="200code">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="200code" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/07/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-07T11:47:31+08:00">
                2017-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/07/hello-world/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  

          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="peter" />
          <p class="site-author-name" itemprop="name">peter</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">peter</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  




  
  

  

  

  

  


</body>
</html>
